<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Advanced R, MAUP and more regression | CASA0005 Geographic Information Systems and Science</title>
  <meta name="description" content="The CASA0005 Geographic Information Systems and Science practical book" />
  <meta name="generator" content="bookdown 0.20.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Advanced R, MAUP and more regression | CASA0005 Geographic Information Systems and Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://andrewmaclachlan.github.io/CASA0005repo/" />
  <meta property="og:image" content="https://andrewmaclachlan.github.io/CASA0005repo/general_images/casa_logo.png" />
  <meta property="og:description" content="The CASA0005 Geographic Information Systems and Science practical book" />
  <meta name="github-repo" content="andrewmaclachlan/CASA0005repo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Advanced R, MAUP and more regression | CASA0005 Geographic Information Systems and Science" />
  
  <meta name="twitter:description" content="The CASA0005 Geographic Information Systems and Science practical book" />
  <meta name="twitter:image" content="https://andrewmaclachlan.github.io/CASA0005repo/general_images/casa_logo.png" />

<meta name="author" content="Andy MacLachlan and Adam Dennett" />


<meta name="date" content="2020-09-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="assets/apple-touch-icon.png" />
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="gwr-and-spatially-lagged-regression.html"/>
<link rel="next" href="assignment-resources-1.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.14/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151934476-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151934476-1');
</script>
<script src="assets/book.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="https://www.ucl.ac.uk/module-catalogue/modules/geographic-information-systems-and-science-CASA0005"><img src="general_images/casa_logo.jpg"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgement"><i class="fa fa-check"></i>Acknowledgement</a></li>
</ul></li>
<li class="part"><span><b>Course information</b></span></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html"><i class="fa fa-check"></i>Hello GIS</a><ul>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#intended-course-learning-outcomes"><i class="fa fa-check"></i>Intended course learning outcomes</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#how-to-use-this-book"><i class="fa fa-check"></i>How to use this book</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#getting-started"><i class="fa fa-check"></i>Getting started</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#how-to-download-data-and-files-from-github"><i class="fa fa-check"></i>How to download data and files from GitHub</a><ul>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#option-1"><i class="fa fa-check"></i>Option 1</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#option-2"><i class="fa fa-check"></i>Option 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#self-guided-learning"><i class="fa fa-check"></i>Self guided learning</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#interactive-lectures"><i class="fa fa-check"></i>Interactive lectures</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#more-help"><i class="fa fa-check"></i>More help</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#noticed-a-mistake"><i class="fa fa-check"></i>Noticed a mistake?</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#assignment-resources"><i class="fa fa-check"></i>Assignment resources</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#reading-list"><i class="fa fa-check"></i>Reading list</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html"><i class="fa fa-check"></i>Software installation</a><ul>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#qgis"><i class="fa fa-check"></i>QGIS</a></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#r"><i class="fa fa-check"></i>R</a><ul>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#setup-1"><i class="fa fa-check"></i>Setup 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#arcgis"><i class="fa fa-check"></i>ArcGIS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html"><i class="fa fa-check"></i>External usage</a><ul>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#how-to-adopt-this-course"><i class="fa fa-check"></i>How to adopt this course</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#issues-contributions"><i class="fa fa-check"></i>Issues / contributions</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#version"><i class="fa fa-check"></i>Version</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="part"><span><b>I GIS tools</b></span></li>
<li class="chapter" data-level="1" data-path="geographic-information.html"><a href="geographic-information.html"><i class="fa fa-check"></i><b>1</b> Geographic Information</a><ul>
<li class="chapter" data-level="1.1" data-path="geographic-information.html"><a href="geographic-information.html#learning-outcomes"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="geographic-information.html"><a href="geographic-information.html#homework"><i class="fa fa-check"></i><b>1.2</b> Homework</a></li>
<li class="chapter" data-level="1.3" data-path="geographic-information.html"><a href="geographic-information.html#recommended-listening"><i class="fa fa-check"></i><b>1.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="1.4" data-path="geographic-information.html"><a href="geographic-information.html#the-basics-of-geographic-information"><i class="fa fa-check"></i><b>1.4</b> The Basics of Geographic Information</a><ul>
<li class="chapter" data-level="1.4.1" data-path="geographic-information.html"><a href="geographic-information.html#data-types-in-statistics"><i class="fa fa-check"></i><b>1.4.1</b> Data types in statistics</a></li>
<li class="chapter" data-level="1.4.2" data-path="geographic-information.html"><a href="geographic-information.html#important-gis-data-formats"><i class="fa fa-check"></i><b>1.4.2</b> Important GIS data formats</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="geographic-information.html"><a href="geographic-information.html#general-data-flow"><i class="fa fa-check"></i><b>1.5</b> General data flow</a></li>
<li class="chapter" data-level="1.6" data-path="geographic-information.html"><a href="geographic-information.html#data"><i class="fa fa-check"></i><b>1.6</b> Data</a><ul>
<li class="chapter" data-level="1.6.1" data-path="geographic-information.html"><a href="geographic-information.html#file-paths"><i class="fa fa-check"></i><b>1.6.1</b> File paths</a></li>
<li class="chapter" data-level="1.6.2" data-path="geographic-information.html"><a href="geographic-information.html#data-download"><i class="fa fa-check"></i><b>1.6.2</b> Data download</a></li>
<li class="chapter" data-level="1.6.3" data-path="geographic-information.html"><a href="geographic-information.html#data-pre-processing"><i class="fa fa-check"></i><b>1.6.3</b> Data pre-processing</a></li>
<li class="chapter" data-level="1.6.4" data-path="geographic-information.html"><a href="geographic-information.html#qgis-1"><i class="fa fa-check"></i><b>1.6.4</b> QGIS</a></li>
<li class="chapter" data-level="1.6.5" data-path="geographic-information.html"><a href="geographic-information.html#r-1"><i class="fa fa-check"></i><b>1.6.5</b> R</a></li>
<li class="chapter" data-level="1.6.6" data-path="geographic-information.html"><a href="geographic-information.html#export-data-1"><i class="fa fa-check"></i><b>1.6.6</b> Export data</a></li>
<li class="chapter" data-level="1.6.7" data-path="geographic-information.html"><a href="geographic-information.html#what-will-i-use-1"><i class="fa fa-check"></i><b>1.6.7</b> What will I use</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="geographic-information.html"><a href="geographic-information.html#data-sources-and-task"><i class="fa fa-check"></i><b>1.7</b> Data sources and task</a><ul>
<li class="chapter" data-level="1.7.1" data-path="geographic-information.html"><a href="geographic-information.html#uk-data-service"><i class="fa fa-check"></i><b>1.7.1</b> UK Data Service</a></li>
<li class="chapter" data-level="1.7.2" data-path="geographic-information.html"><a href="geographic-information.html#ons"><i class="fa fa-check"></i><b>1.7.2</b> ONS</a></li>
<li class="chapter" data-level="1.7.3" data-path="geographic-information.html"><a href="geographic-information.html#nomis"><i class="fa fa-check"></i><b>1.7.3</b> nomis</a></li>
<li class="chapter" data-level="1.7.4" data-path="geographic-information.html"><a href="geographic-information.html#os"><i class="fa fa-check"></i><b>1.7.4</b> OS</a></li>
<li class="chapter" data-level="1.7.5" data-path="geographic-information.html"><a href="geographic-information.html#edina-digimap"><i class="fa fa-check"></i><b>1.7.5</b> Edina Digimap</a></li>
<li class="chapter" data-level="1.7.6" data-path="geographic-information.html"><a href="geographic-information.html#osm"><i class="fa fa-check"></i><b>1.7.6</b> OSM</a></li>
<li class="chapter" data-level="1.7.7" data-path="geographic-information.html"><a href="geographic-information.html#defra"><i class="fa fa-check"></i><b>1.7.7</b> DEFRA</a></li>
<li class="chapter" data-level="1.7.8" data-path="geographic-information.html"><a href="geographic-information.html#data-lists"><i class="fa fa-check"></i><b>1.7.8</b> Data lists</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="geographic-information.html"><a href="geographic-information.html#summary"><i class="fa fa-check"></i><b>1.8</b> Summary</a></li>
<li class="chapter" data-level="1.9" data-path="geographic-information.html"><a href="geographic-information.html#feedback"><i class="fa fa-check"></i><b>1.9</b> Feedback</a></li>
<li class="chapter" data-level="1.10" data-path="geographic-information.html"><a href="geographic-information.html#mac-r-issues"><i class="fa fa-check"></i><b>1.10</b> Mac R issues</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#learning-outcomes-1"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#homework-1"><i class="fa fa-check"></i><b>2.2</b> Homework</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#recommended-listening-1"><i class="fa fa-check"></i><b>2.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#introduction-1"><i class="fa fa-check"></i><b>2.4</b> Introduction</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#online-forums-are-your-friend"><i class="fa fa-check"></i><b>2.4.1</b> Online forums are your friend!!</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#health-warning"><i class="fa fa-check"></i><b>2.4.2</b> Health warning</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-and-rstudio"><i class="fa fa-check"></i><b>2.4.3</b> R and RStudio</a></li>
<li class="chapter" data-level="2.4.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started-1"><i class="fa fa-check"></i><b>2.4.4</b> Getting started</a></li>
<li class="chapter" data-level="2.4.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basics"><i class="fa fa-check"></i><b>2.4.5</b> Basics</a></li>
<li class="chapter" data-level="2.4.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#scripts-and-some-basic-commands"><i class="fa fa-check"></i><b>2.4.6</b> Scripts and some basic commands</a></li>
<li class="chapter" data-level="2.4.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>2.4.7</b> Functions</a></li>
<li class="chapter" data-level="2.4.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-plotting"><i class="fa fa-check"></i><b>2.4.8</b> Basic plotting</a></li>
<li class="chapter" data-level="2.4.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#help"><i class="fa fa-check"></i><b>2.4.9</b> Help</a></li>
<li class="chapter" data-level="2.4.10" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-structures"><i class="fa fa-check"></i><b>2.4.10</b> Data structures</a></li>
<li class="chapter" data-level="2.4.11" data-path="introduction-to-r.html"><a href="introduction-to-r.html#elements-of-a-data-frame"><i class="fa fa-check"></i><b>2.4.11</b> Elements of a data frame</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.5</b> Reading data into R</a><ul>
<li class="chapter" data-level="2.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#old-skool-cleaning"><i class="fa fa-check"></i><b>2.5.1</b> Old skool cleaning</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#here"><i class="fa fa-check"></i><b>2.5.2</b> Here</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#new-skool-cleaning"><i class="fa fa-check"></i><b>2.5.3</b> New skool cleaning</a></li>
<li class="chapter" data-level="2.5.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#examining-your-new-data"><i class="fa fa-check"></i><b>2.5.4</b> Examining your new data</a></li>
<li class="chapter" data-level="2.5.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-manipulation-in-r"><i class="fa fa-check"></i><b>2.5.5</b> Data manipulation in R</a></li>
<li class="chapter" data-level="2.5.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#plotting"><i class="fa fa-check"></i><b>2.5.6</b> Plotting</a></li>
<li class="chapter" data-level="2.5.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#pimp-my-graph"><i class="fa fa-check"></i><b>2.5.7</b> Pimp my graph!</a></li>
<li class="chapter" data-level="2.5.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#spatial-data-in-r"><i class="fa fa-check"></i><b>2.5.8</b> Spatial Data in R</a></li>
<li class="chapter" data-level="2.5.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#simple-mapping"><i class="fa fa-check"></i><b>2.5.9</b> Simple mapping</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#tidying-data"><i class="fa fa-check"></i><b>2.6</b> Tidying data</a></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#feedback-1"><i class="fa fa-check"></i><b>2.7</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html"><i class="fa fa-check"></i><b>3</b> Rasters, descriptive statistics and interpolation</a><ul>
<li class="chapter" data-level="3.1" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#learning-outcomes-2"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#homework-2"><i class="fa fa-check"></i><b>3.2</b> Homework</a></li>
<li class="chapter" data-level="3.3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#recommended-listening-2"><i class="fa fa-check"></i><b>3.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="3.4" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#introduction-2"><i class="fa fa-check"></i><b>3.4</b> Introduction</a></li>
<li class="chapter" data-level="3.5" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#part-1-projections"><i class="fa fa-check"></i><b>3.5</b> Part 1 projections</a><ul>
<li class="chapter" data-level="3.5.1" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#changing-projections"><i class="fa fa-check"></i><b>3.5.1</b> Changing projections</a></li>
<li class="chapter" data-level="3.5.2" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#worldclim-data"><i class="fa fa-check"></i><b>3.5.2</b> WorldClim data</a></li>
<li class="chapter" data-level="3.5.3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#worldclim-data-loading-efficiently"><i class="fa fa-check"></i><b>3.5.3</b> WorldClim data loading efficiently</a></li>
<li class="chapter" data-level="3.5.4" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#location-data-from-a-raster"><i class="fa fa-check"></i><b>3.5.4</b> Location data from a raster</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#part-2-descriptive-statistics"><i class="fa fa-check"></i><b>3.6</b> Part 2 descriptive statistics</a><ul>
<li class="chapter" data-level="3.6.1" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#data-preparation"><i class="fa fa-check"></i><b>3.6.1</b> Data preparation</a></li>
<li class="chapter" data-level="3.6.2" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#histogram"><i class="fa fa-check"></i><b>3.6.2</b> Histogram</a></li>
<li class="chapter" data-level="3.6.3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#using-more-data"><i class="fa fa-check"></i><b>3.6.3</b> Using more data</a></li>
<li class="chapter" data-level="3.6.4" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#histogram-with-ggplot"><i class="fa fa-check"></i><b>3.6.4</b> Histogram with ggplot</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#part-3-interpolation"><i class="fa fa-check"></i><b>3.7</b> Part 3 interpolation</a></li>
<li class="chapter" data-level="3.8" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#auto-data-download"><i class="fa fa-check"></i><b>3.8</b> Auto data download</a></li>
<li class="chapter" data-level="3.9" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#advanced-analysis"><i class="fa fa-check"></i><b>3.9</b> Advanced analysis</a></li>
<li class="chapter" data-level="3.10" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#feedback-2"><i class="fa fa-check"></i><b>3.10</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html"><i class="fa fa-check"></i><b>4</b> Git, GitHub and RMarkdown</a><ul>
<li class="chapter" data-level="4.1" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#learning-outcomes-3"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#homework-3"><i class="fa fa-check"></i><b>4.2</b> Homework</a></li>
<li class="chapter" data-level="4.3" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#recommended-listening-3"><i class="fa fa-check"></i><b>4.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="4.4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#introduction-3"><i class="fa fa-check"></i><b>4.4</b> Introduction</a></li>
<li class="chapter" data-level="4.5" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#git-and-github"><i class="fa fa-check"></i><b>4.5</b> Git and GitHub</a><ul>
<li class="chapter" data-level="4.5.1" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#the-three-ways"><i class="fa fa-check"></i><b>4.5.1</b> The three ways</a></li>
<li class="chapter" data-level="4.5.2" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#set-up-your-github"><i class="fa fa-check"></i><b>4.5.2</b> Set up your GitHub</a></li>
<li class="chapter" data-level="4.5.3" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#using-rstudio-with-git"><i class="fa fa-check"></i><b>4.5.3</b> Using RStudio with Git</a></li>
<li class="chapter" data-level="4.5.4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#using-the-git-gui---way-1"><i class="fa fa-check"></i><b>4.5.4</b> Using the Git GUI - way 1</a></li>
<li class="chapter" data-level="4.5.5" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#create-a-new-version-control-in-rstudio---way-2"><i class="fa fa-check"></i><b>4.5.5</b> Create a new version control in RStudio - way 2</a></li>
<li class="chapter" data-level="4.5.6" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#if-have-have-an-existing-project---way-3"><i class="fa fa-check"></i><b>4.5.6</b> If have have an existing project - way 3</a></li>
<li class="chapter" data-level="4.5.7" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#commiting-to-git"><i class="fa fa-check"></i><b>4.5.7</b> Commiting to Git</a></li>
<li class="chapter" data-level="4.5.8" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#using-git-outside-rstudio"><i class="fa fa-check"></i><b>4.5.8</b> Using Git outside RStudio</a></li>
<li class="chapter" data-level="4.5.9" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#push-to-github"><i class="fa fa-check"></i><b>4.5.9</b> Push to Github</a></li>
<li class="chapter" data-level="4.5.10" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#pull-from-github"><i class="fa fa-check"></i><b>4.5.10</b> Pull from GitHub</a></li>
<li class="chapter" data-level="4.5.11" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#troubleshooting"><i class="fa fa-check"></i><b>4.5.11</b> Troubleshooting</a></li>
<li class="chapter" data-level="4.5.12" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#fork-a-repository"><i class="fa fa-check"></i><b>4.5.12</b> Fork a repository</a></li>
<li class="chapter" data-level="4.5.13" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#branches"><i class="fa fa-check"></i><b>4.5.13</b> Branches</a></li>
<li class="chapter" data-level="4.5.14" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#back-in-time"><i class="fa fa-check"></i><b>4.5.14</b> Back in time</a></li>
<li class="chapter" data-level="4.5.15" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#health-warning-1"><i class="fa fa-check"></i><b>4.5.15</b> Health warning</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#rmarkdown"><i class="fa fa-check"></i><b>4.6</b> RMarkdown</a><ul>
<li class="chapter" data-level="4.6.1" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#html"><i class="fa fa-check"></i><b>4.6.1</b> HTML</a></li>
<li class="chapter" data-level="4.6.2" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#flexdashboard"><i class="fa fa-check"></i><b>4.6.2</b> Flexdashboard</a></li>
<li class="chapter" data-level="4.6.3" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#word-document"><i class="fa fa-check"></i><b>4.6.3</b> Word document</a></li>
<li class="chapter" data-level="4.6.4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#knit-options"><i class="fa fa-check"></i><b>4.6.4</b> Knit options</a></li>
<li class="chapter" data-level="4.6.5" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#shortcuts"><i class="fa fa-check"></i><b>4.6.5</b> Shortcuts</a></li>
<li class="chapter" data-level="4.6.6" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#adding-references"><i class="fa fa-check"></i><b>4.6.6</b> Adding references</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#binder"><i class="fa fa-check"></i><b>4.7</b> Binder</a></li>
<li class="chapter" data-level="4.8" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#further-reading"><i class="fa fa-check"></i><b>4.8</b> Further reading</a></li>
<li class="chapter" data-level="4.9" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#feedback-3"><i class="fa fa-check"></i><b>4.9</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="map-making.html"><a href="map-making.html"><i class="fa fa-check"></i><b>5</b> Map making</a><ul>
<li class="chapter" data-level="5.1" data-path="map-making.html"><a href="map-making.html#learning-outcomes-4"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="map-making.html"><a href="map-making.html#homework-4"><i class="fa fa-check"></i><b>5.2</b> Homework</a></li>
<li class="chapter" data-level="5.3" data-path="map-making.html"><a href="map-making.html#recommended-listening-4"><i class="fa fa-check"></i><b>5.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="5.4" data-path="map-making.html"><a href="map-making.html#introduction-4"><i class="fa fa-check"></i><b>5.4</b> Introduction</a><ul>
<li class="chapter" data-level="5.4.1" data-path="map-making.html"><a href="map-making.html#osm-1"><i class="fa fa-check"></i><b>5.4.1</b> OSM</a></li>
<li class="chapter" data-level="5.4.2" data-path="map-making.html"><a href="map-making.html#airbnb"><i class="fa fa-check"></i><b>5.4.2</b> Airbnb</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="map-making.html"><a href="map-making.html#data-1"><i class="fa fa-check"></i><b>5.5</b> Data</a><ul>
<li class="chapter" data-level="5.5.1" data-path="map-making.html"><a href="map-making.html#osm-2"><i class="fa fa-check"></i><b>5.5.1</b> OSM</a></li>
<li class="chapter" data-level="5.5.2" data-path="map-making.html"><a href="map-making.html#london-boroughs"><i class="fa fa-check"></i><b>5.5.2</b> London boroughs</a></li>
<li class="chapter" data-level="5.5.3" data-path="map-making.html"><a href="map-making.html#world-cities"><i class="fa fa-check"></i><b>5.5.3</b> World cities</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="map-making.html"><a href="map-making.html#qgis-2"><i class="fa fa-check"></i><b>5.6</b> QGIS</a><ul>
<li class="chapter" data-level="5.6.1" data-path="map-making.html"><a href="map-making.html#load-data-2"><i class="fa fa-check"></i><b>5.6.1</b> Load data</a></li>
<li class="chapter" data-level="5.6.2" data-path="map-making.html"><a href="map-making.html#manipulate-data"><i class="fa fa-check"></i><b>5.6.2</b> Manipulate data</a></li>
<li class="chapter" data-level="5.6.3" data-path="map-making.html"><a href="map-making.html#map-data"><i class="fa fa-check"></i><b>5.6.3</b> Map data</a></li>
<li class="chapter" data-level="5.6.4" data-path="map-making.html"><a href="map-making.html#export-map"><i class="fa fa-check"></i><b>5.6.4</b> Export map</a></li>
<li class="chapter" data-level="5.6.5" data-path="map-making.html"><a href="map-making.html#graphical-modeler"><i class="fa fa-check"></i><b>5.6.5</b> Graphical modeler</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="map-making.html"><a href="map-making.html#r-2"><i class="fa fa-check"></i><b>5.7</b> R</a><ul>
<li class="chapter" data-level="5.7.1" data-path="map-making.html"><a href="map-making.html#static-map"><i class="fa fa-check"></i><b>5.7.1</b> Static map</a></li>
<li class="chapter" data-level="5.7.2" data-path="map-making.html"><a href="map-making.html#export"><i class="fa fa-check"></i><b>5.7.2</b> Export</a></li>
<li class="chapter" data-level="5.7.3" data-path="map-making.html"><a href="map-making.html#basic-interactive-map"><i class="fa fa-check"></i><b>5.7.3</b> Basic interactive map</a></li>
<li class="chapter" data-level="5.7.4" data-path="map-making.html"><a href="map-making.html#advanced-interactive-map"><i class="fa fa-check"></i><b>5.7.4</b> Advanced interactive map</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="map-making.html"><a href="map-making.html#bad-maps"><i class="fa fa-check"></i><b>5.8</b> Bad maps</a></li>
<li class="chapter" data-level="5.9" data-path="map-making.html"><a href="map-making.html#feedback-4"><i class="fa fa-check"></i><b>5.9</b> Feedback</a></li>
</ul></li>
<li class="part"><span><b>II GIS analysis</b></span></li>
<li class="chapter" data-level="6" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html"><i class="fa fa-check"></i><b>6</b> Analysing spatial patterns</a><ul>
<li class="chapter" data-level="6.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#learning-outcomes-5"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#homework-5"><i class="fa fa-check"></i><b>6.2</b> Homework</a></li>
<li class="chapter" data-level="6.3" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#recommended-listening-5"><i class="fa fa-check"></i><b>6.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="6.4" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#introduction-5"><i class="fa fa-check"></i><b>6.4</b> Introduction</a></li>
<li class="chapter" data-level="6.5" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#setting-up-your-data"><i class="fa fa-check"></i><b>6.5</b> Setting up your data</a><ul>
<li class="chapter" data-level="6.5.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-cleaning"><i class="fa fa-check"></i><b>6.5.1</b> Data cleaning</a></li>
<li class="chapter" data-level="6.5.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#study-area"><i class="fa fa-check"></i><b>6.5.2</b> Study area</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#point-pattern-analysis"><i class="fa fa-check"></i><b>6.6</b> Point pattern analysis</a><ul>
<li class="chapter" data-level="6.6.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#kernel-density-estimation"><i class="fa fa-check"></i><b>6.6.1</b> Kernel Density Estimation</a></li>
<li class="chapter" data-level="6.6.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#quadrat-analysis"><i class="fa fa-check"></i><b>6.6.2</b> Quadrat Analysis</a></li>
<li class="chapter" data-level="6.6.3" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#try-experimenting"><i class="fa fa-check"></i><b>6.6.3</b> Try experimentingâ€¦</a></li>
<li class="chapter" data-level="6.6.4" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#ripleys-k"><i class="fa fa-check"></i><b>6.6.4</b> Ripleyâ€™s K</a></li>
<li class="chapter" data-level="6.6.5" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#alternatives-to-ripleys-k"><i class="fa fa-check"></i><b>6.6.5</b> Alternatives to Ripleyâ€™s K</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#density-based-spatial-clustering-of-applications-with-noise-dbscan"><i class="fa fa-check"></i><b>6.7</b> Density-based spatial clustering of applications with noise: DBSCAN</a></li>
<li class="chapter" data-level="6.8" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#point-pattern-analysis-summary"><i class="fa fa-check"></i><b>6.8</b> Point pattern analysis summary</a></li>
<li class="chapter" data-level="6.9" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#analysing-spatial-autocorrelation-with-morans-i-lisa-and-friends"><i class="fa fa-check"></i><b>6.9</b> Analysing Spatial Autocorrelation with Moranâ€™s I, LISA and friends</a><ul>
<li class="chapter" data-level="6.9.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-download-1"><i class="fa fa-check"></i><b>6.9.1</b> Data download</a></li>
<li class="chapter" data-level="6.9.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-cleaning-1"><i class="fa fa-check"></i><b>6.9.2</b> Data cleaning</a></li>
<li class="chapter" data-level="6.9.3" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-manipulation"><i class="fa fa-check"></i><b>6.9.3</b> Data manipulation</a></li>
<li class="chapter" data-level="6.9.4" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#spatial-autocorrelation"><i class="fa fa-check"></i><b>6.9.4</b> Spatial autocorrelation</a></li>
<li class="chapter" data-level="6.9.5" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#mapping-outputs"><i class="fa fa-check"></i><b>6.9.5</b> Mapping outputs</a></li>
<li class="chapter" data-level="6.9.6" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#other-variables"><i class="fa fa-check"></i><b>6.9.6</b> Other variables</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#extension"><i class="fa fa-check"></i><b>6.10</b> Extension</a></li>
<li class="chapter" data-level="6.11" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#feedback-5"><i class="fa fa-check"></i><b>6.11</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html"><i class="fa fa-check"></i><b>7</b> Advanced raster analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#learning-objectives"><i class="fa fa-check"></i><b>7.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#homework-6"><i class="fa fa-check"></i><b>7.2</b> Homework</a></li>
<li class="chapter" data-level="7.3" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#recommended-listening-6"><i class="fa fa-check"></i><b>7.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="7.4" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#introduction-6"><i class="fa fa-check"></i><b>7.4</b> Introduction</a></li>
<li class="chapter" data-level="7.5" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#gitignore"><i class="fa fa-check"></i><b>7.5</b> .gitignore</a><ul>
<li class="chapter" data-level="7.5.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#remote-sensing-background-required"><i class="fa fa-check"></i><b>7.5.1</b> Remote sensing background (required)</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#data-2"><i class="fa fa-check"></i><b>7.6</b> Data</a><ul>
<li class="chapter" data-level="7.6.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#shapefile"><i class="fa fa-check"></i><b>7.6.1</b> Shapefile</a></li>
<li class="chapter" data-level="7.6.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#raster-data-landsat"><i class="fa fa-check"></i><b>7.6.2</b> Raster data (Landsat)</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#processing-raster-data"><i class="fa fa-check"></i><b>7.7</b> Processing raster data</a><ul>
<li class="chapter" data-level="7.7.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#loading"><i class="fa fa-check"></i><b>7.7.1</b> Loading</a></li>
<li class="chapter" data-level="7.7.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#resampling"><i class="fa fa-check"></i><b>7.7.2</b> Resampling</a></li>
<li class="chapter" data-level="7.7.3" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#clipping"><i class="fa fa-check"></i><b>7.7.3</b> Clipping</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#data-exploration"><i class="fa fa-check"></i><b>7.8</b> Data exploration</a><ul>
<li class="chapter" data-level="7.8.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#more-loading-and-manipulating"><i class="fa fa-check"></i><b>7.8.1</b> More loading and manipulating</a></li>
<li class="chapter" data-level="7.8.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#plotting-data"><i class="fa fa-check"></i><b>7.8.2</b> Plotting data</a></li>
<li class="chapter" data-level="7.8.3" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#data-similarity"><i class="fa fa-check"></i><b>7.8.3</b> Data similarity</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#basic-raster-calculations"><i class="fa fa-check"></i><b>7.9</b> Basic raster calculations</a><ul>
<li class="chapter" data-level="7.9.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#ndvi"><i class="fa fa-check"></i><b>7.9.1</b> NDVI</a></li>
<li class="chapter" data-level="7.9.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#ndvi-function"><i class="fa fa-check"></i><b>7.9.2</b> NDVI function</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#advanced-raster-calculations"><i class="fa fa-check"></i><b>7.10</b> Advanced raster calculations</a><ul>
<li class="chapter" data-level="7.10.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#calucating-tempearture-from-landsat-data"><i class="fa fa-check"></i><b>7.10.1</b> Calucating tempearture from Landsat data</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#calucating-urban-area-from-landsat-data"><i class="fa fa-check"></i><b>7.11</b> Calucating urban area from Landsat data</a></li>
<li class="chapter" data-level="7.12" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#urban-area-and-temperature-relationship"><i class="fa fa-check"></i><b>7.12</b> Urban area and temperature relationship</a></li>
<li class="chapter" data-level="7.13" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#statistical-summary"><i class="fa fa-check"></i><b>7.13</b> Statistical summary</a></li>
<li class="chapter" data-level="7.14" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#considerations"><i class="fa fa-check"></i><b>7.14</b> Considerations</a></li>
<li class="chapter" data-level="7.15" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#extension-1"><i class="fa fa-check"></i><b>7.15</b> Extension</a></li>
<li class="chapter" data-level="7.16" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#references"><i class="fa fa-check"></i><b>7.16</b> References</a></li>
<li class="chapter" data-level="7.17" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#remote-sensing-background-optional"><i class="fa fa-check"></i><b>7.17</b> Remote sensing background (optional)</a></li>
<li class="chapter" data-level="7.18" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#feedback-6"><i class="fa fa-check"></i><b>7.18</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html"><i class="fa fa-check"></i><b>8</b> Online mapping / descriptive statistics</a><ul>
<li class="chapter" data-level="8.1" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#homework-7"><i class="fa fa-check"></i><b>8.1</b> Homework</a></li>
<li class="chapter" data-level="8.2" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#recommended-listening-7"><i class="fa fa-check"></i><b>8.2</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="8.3" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#part-a-spatial-descriptive-statistics"><i class="fa fa-check"></i><b>8.3</b> Part A spatial descriptive statistics</a><ul>
<li class="chapter" data-level="8.3.1" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#learning-objectives-1"><i class="fa fa-check"></i><b>8.3.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.3.2" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#getting-started-2"><i class="fa fa-check"></i><b>8.3.2</b> Getting Started</a></li>
<li class="chapter" data-level="8.3.3" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#main-tasks"><i class="fa fa-check"></i><b>8.3.3</b> Main Tasks</a></li>
<li class="chapter" data-level="8.3.4" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-1---descriptive-statistics"><i class="fa fa-check"></i><b>8.3.4</b> Task 1 - Descriptive Statistics</a></li>
<li class="chapter" data-level="8.3.5" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#extension-1-1"><i class="fa fa-check"></i><b>8.3.5</b> Extension 1</a></li>
<li class="chapter" data-level="8.3.6" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-2---function-to-recode-data"><i class="fa fa-check"></i><b>8.3.6</b> Task 2 - Function to recode data</a></li>
<li class="chapter" data-level="8.3.7" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#whats-going-on-in-this-function"><i class="fa fa-check"></i><b>8.3.7</b> Whatâ€™s going on in this function?</a></li>
<li class="chapter" data-level="8.3.8" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-3-mapping-location-quotients"><i class="fa fa-check"></i><b>8.3.8</b> Task 3 â€“ Mapping Location Quotients</a></li>
<li class="chapter" data-level="8.3.9" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-4-creating-a-basic-geodemographic-classification"><i class="fa fa-check"></i><b>8.3.9</b> Task 4 â€“ Creating a Basic Geodemographic Classification</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#part-b-online-mapping"><i class="fa fa-check"></i><b>8.4</b> Part B Online mapping</a><ul>
<li class="chapter" data-level="8.4.1" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.4.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.4.2" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#introduction-7"><i class="fa fa-check"></i><b>8.4.2</b> Introduction</a></li>
<li class="chapter" data-level="8.4.3" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#rpubs"><i class="fa fa-check"></i><b>8.4.3</b> RPubs</a></li>
<li class="chapter" data-level="8.4.4" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#rmarkdown-site-generator"><i class="fa fa-check"></i><b>8.4.4</b> RMarkdown site generator</a></li>
<li class="chapter" data-level="8.4.5" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#warning"><i class="fa fa-check"></i><b>8.4.5</b> Warning</a></li>
<li class="chapter" data-level="8.4.6" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#advanced-online-publishing"><i class="fa fa-check"></i><b>8.4.6</b> Advanced online publishing</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#feedback-7"><i class="fa fa-check"></i><b>8.5</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html"><i class="fa fa-check"></i><b>9</b> GWR and spatially lagged regression</a><ul>
<li class="chapter" data-level="9.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#learning-objectives-3"><i class="fa fa-check"></i><b>9.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#homework-8"><i class="fa fa-check"></i><b>9.2</b> Homework</a></li>
<li class="chapter" data-level="9.3" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#recommended-listening-8"><i class="fa fa-check"></i><b>9.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="9.4" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#introduction-8"><i class="fa fa-check"></i><b>9.4</b> Introduction</a><ul>
<li class="chapter" data-level="9.4.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#setting-up-your-data-1"><i class="fa fa-check"></i><b>9.4.1</b> Setting up your Data</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#analysing-gcse-exam-performance---testing-a-research-hypothesis"><i class="fa fa-check"></i><b>9.5</b> Analysing GCSE exam performance - testing a research hypothesis</a><ul>
<li class="chapter" data-level="9.5.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#research-question-and-hypothesis"><i class="fa fa-check"></i><b>9.5.1</b> Research Question and Hypothesis</a></li>
<li class="chapter" data-level="9.5.2" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#regression-basics"><i class="fa fa-check"></i><b>9.5.2</b> Regression Basics</a></li>
<li class="chapter" data-level="9.5.3" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#running-a-regression-model-in-r"><i class="fa fa-check"></i><b>9.5.3</b> Running a Regression Model in R</a></li>
<li class="chapter" data-level="9.5.4" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#bootstrap-resampling"><i class="fa fa-check"></i><b>9.5.4</b> Bootstrap resampling</a></li>
<li class="chapter" data-level="9.5.5" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumptions-underpinning-linear-regression"><i class="fa fa-check"></i><b>9.5.5</b> Assumptions Underpinning Linear Regression</a></li>
<li class="chapter" data-level="9.5.6" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-1---there-is-a-linear-relationship-between-the-dependent-and-independent-variables"><i class="fa fa-check"></i><b>9.5.6</b> Assumption 1 - There is a linear relationship between the dependent and independent variables</a></li>
<li class="chapter" data-level="9.5.7" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-2---the-residuals-in-your-model-should-be-normally-distributed"><i class="fa fa-check"></i><b>9.5.7</b> Assumption 2 - The residuals in your model should be normally distributed</a></li>
<li class="chapter" data-level="9.5.8" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-3---no-multicolinearity-in-the-independent-variables"><i class="fa fa-check"></i><b>9.5.8</b> Assumption 3 - No Multicolinearity in the independent variables</a></li>
<li class="chapter" data-level="9.5.9" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-4---homoscedasticity"><i class="fa fa-check"></i><b>9.5.9</b> Assumption 4 - Homoscedasticity</a></li>
<li class="chapter" data-level="9.5.10" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-5---independence-of-errors"><i class="fa fa-check"></i><b>9.5.10</b> Assumption 5 - Independence of Errors</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#spatial-regression-models"><i class="fa fa-check"></i><b>9.6</b> Spatial Regression Models</a><ul>
<li class="chapter" data-level="9.6.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#dealing-with-spatially-autocorrelated-residuals---spatial-lag-and-spatial-error-models"><i class="fa fa-check"></i><b>9.6.1</b> Dealing with Spatially Autocorrelated Residuals - Spatial Lag and Spatial Error models</a></li>
<li class="chapter" data-level="9.6.2" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#spatial-regression-model-in-r"><i class="fa fa-check"></i><b>9.6.2</b> Spatial regression model in R</a></li>
<li class="chapter" data-level="9.6.3" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#extending-your-regression-model---dummy-variables"><i class="fa fa-check"></i><b>9.6.3</b> Extending your regression model - Dummy Variables</a></li>
<li class="chapter" data-level="9.6.4" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#task-investigating-further---adding-more-explanatory-variables-into-a-multiple-regression-model"><i class="fa fa-check"></i><b>9.6.4</b> TASK: Investigating Further - Adding More Explanatory Variables into a multiple regression model</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#task-3---spatial-non-stationarity-and-geographically-weighted-regression-models-gwr"><i class="fa fa-check"></i><b>9.7</b> Task 3 - Spatial Non-stationarity and Geographically Weighted Regression Models (GWR)</a></li>
<li class="chapter" data-level="9.8" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#feedback-8"><i class="fa fa-check"></i><b>9.8</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html"><i class="fa fa-check"></i><b>10</b> Advanced R, MAUP and more regression</a><ul>
<li class="chapter" data-level="10.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#learning-outcomes-6"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#homework-9"><i class="fa fa-check"></i><b>10.2</b> Homework</a></li>
<li class="chapter" data-level="10.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#recommended-listening-9"><i class="fa fa-check"></i><b>10.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="10.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#introduction-9"><i class="fa fa-check"></i><b>10.4</b> Introduction</a></li>
<li class="chapter" data-level="10.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#maup"><i class="fa fa-check"></i><b>10.5</b> MAUP</a><ul>
<li class="chapter" data-level="10.5.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#get-the-data"><i class="fa fa-check"></i><b>10.5.1</b> Get the data</a></li>
<li class="chapter" data-level="10.5.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#project-the-data"><i class="fa fa-check"></i><b>10.5.2</b> Project the data</a></li>
<li class="chapter" data-level="10.5.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#functions-1"><i class="fa fa-check"></i><b>10.5.3</b> Functions</a></li>
<li class="chapter" data-level="10.5.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#loops"><i class="fa fa-check"></i><b>10.5.4</b> Loops</a></li>
<li class="chapter" data-level="10.5.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#advanced-mapping-again"><i class="fa fa-check"></i><b>10.5.5</b> Advanced mapping (again)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#regression-relationships"><i class="fa fa-check"></i><b>10.6</b> Regression relationships</a><ul>
<li class="chapter" data-level="10.6.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#preprocessing"><i class="fa fa-check"></i><b>10.6.1</b> Preprocessing</a></li>
<li class="chapter" data-level="10.6.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#scatter-plot"><i class="fa fa-check"></i><b>10.6.2</b> Scatter plot</a></li>
<li class="chapter" data-level="10.6.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#outliers"><i class="fa fa-check"></i><b>10.6.3</b> Outliers</a></li>
<li class="chapter" data-level="10.6.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#correlation"><i class="fa fa-check"></i><b>10.6.4</b> Correlation</a></li>
<li class="chapter" data-level="10.6.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#linear-model"><i class="fa fa-check"></i><b>10.6.5</b> Linear model</a></li>
<li class="chapter" data-level="10.6.6" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#linear-model-outputs"><i class="fa fa-check"></i><b>10.6.6</b> Linear model outputs</a></li>
<li class="chapter" data-level="10.6.7" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#validation"><i class="fa fa-check"></i><b>10.6.7</b> Validation</a></li>
<li class="chapter" data-level="10.6.8" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#cross-validation"><i class="fa fa-check"></i><b>10.6.8</b> Cross validation</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#advanced-regression"><i class="fa fa-check"></i><b>10.7</b> Advanced regression</a><ul>
<li class="chapter" data-level="10.7.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#more-data"><i class="fa fa-check"></i><b>10.7.1</b> More data</a></li>
<li class="chapter" data-level="10.7.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>10.7.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="10.7.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#ridge-regression"><i class="fa fa-check"></i><b>10.7.3</b> Ridge regression</a></li>
<li class="chapter" data-level="10.7.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#lasso"><i class="fa fa-check"></i><b>10.7.4</b> LASSO</a></li>
<li class="chapter" data-level="10.7.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#elastic-net-regression"><i class="fa fa-check"></i><b>10.7.5</b> Elastic net regression</a></li>
<li class="chapter" data-level="10.7.6" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#whats-the-best-here"><i class="fa fa-check"></i><b>10.7.6</b> Whatâ€™s the best here</a></li>
<li class="chapter" data-level="10.7.7" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#what-should-i-use"><i class="fa fa-check"></i><b>10.7.7</b> What should i use</a></li>
<li class="chapter" data-level="10.7.8" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#so-how-do-i-predict"><i class="fa fa-check"></i><b>10.7.8</b> So how do i predict</a></li>
<li class="chapter" data-level="10.7.9" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#should-i-write-advanced-code"><i class="fa fa-check"></i><b>10.7.9</b> Should i write advanced code</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#more-resources"><i class="fa fa-check"></i><b>10.8</b> More resources</a></li>
<li class="chapter" data-level="10.9" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#extension-2"><i class="fa fa-check"></i><b>10.9</b> Extension</a></li>
<li class="chapter" data-level="10.10" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#acknowledgement-1"><i class="fa fa-check"></i><b>10.10</b> Acknowledgement</a></li>
<li class="chapter" data-level="10.11" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#feedback-9"><i class="fa fa-check"></i><b>10.11</b> Feedback</a></li>
</ul></li>
<li class="part"><span><b>Assignment</b></span></li>
<li class="chapter" data-level="11" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html"><i class="fa fa-check"></i><b>11</b> Assignment resources</a><ul>
<li class="chapter" data-level="11.1" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#timeline"><i class="fa fa-check"></i><b>11.1</b> Timeline</a></li>
<li class="chapter" data-level="11.2" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#markscheme"><i class="fa fa-check"></i><b>11.2</b> Markscheme</a></li>
<li class="chapter" data-level="11.3" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#examples-of-previous-work"><i class="fa fa-check"></i><b>11.3</b> Examples of previous work</a></li>
<li class="chapter" data-level="11.4" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#events-meet-other-spatial-data-professionals"><i class="fa fa-check"></i><b>11.4</b> Events / meet other spatial data professionals</a></li>
<li class="chapter" data-level="11.5" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#cool-stuff-to-explore"><i class="fa fa-check"></i><b>11.5</b> Cool stuff to explore</a></li>
<li class="chapter" data-level="11.6" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#assignment-ideas"><i class="fa fa-check"></i><b>11.6</b> Assignment ideas</a></li>
<li class="chapter" data-level="11.7" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#booksreading-resources"><i class="fa fa-check"></i><b>11.7</b> Books/reading resources</a></li>
<li class="chapter" data-level="11.8" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#new-developments"><i class="fa fa-check"></i><b>11.8</b> New developments</a><ul>
<li class="chapter" data-level="11.8.1" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#twitter"><i class="fa fa-check"></i><b>11.8.1</b> Twitter</a></li>
</ul></li>
<li class="chapter" data-level="11.9" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#data-3"><i class="fa fa-check"></i><b>11.9</b> Data</a></li>
<li class="chapter" data-level="11.10" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#data-lists-1"><i class="fa fa-check"></i><b>11.10</b> Data lists</a></li>
<li class="chapter" data-level="11.11" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#reading-and-writing-critically"><i class="fa fa-check"></i><b>11.11</b> Reading and writing critically</a></li>
<li class="chapter" data-level="11.12" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#free-flow-diagram-tools"><i class="fa fa-check"></i><b>11.12</b> Free flow diagram tools</a></li>
<li class="chapter" data-level="11.13" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#basics-1"><i class="fa fa-check"></i><b>11.13</b> Basics</a><ul>
<li class="chapter" data-level="11.13.1" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#introduction-10"><i class="fa fa-check"></i><b>11.13.1</b> Introduction</a></li>
<li class="chapter" data-level="11.13.2" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#literature-review"><i class="fa fa-check"></i><b>11.13.2</b> Literature review</a></li>
<li class="chapter" data-level="11.13.3" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#methodology"><i class="fa fa-check"></i><b>11.13.3</b> Methodology</a></li>
<li class="chapter" data-level="11.13.4" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#results"><i class="fa fa-check"></i><b>11.13.4</b> Results</a></li>
<li class="chapter" data-level="11.13.5" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#discussion"><i class="fa fa-check"></i><b>11.13.5</b> Discussion</a></li>
<li class="chapter" data-level="11.13.6" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#conclusion"><i class="fa fa-check"></i><b>11.13.6</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./external-usage.html#license">
    License: CC-BY-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CASA0005 Geographic Information Systems and Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-r-maup-and-more-regression" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Advanced R, MAUP and more regression</h1>
<div id="learning-outcomes-6" class="section level2">
<h2><span class="header-section-number">10.1</span> Learning outcomes</h2>
<ol style="list-style-type: decimal">
<li>Describe, explain and visualise the MAUP problem</li>
<li>Design and use loops and functions</li>
<li>Execute linear, Ridge and LASSO regression to predict values (e.g.Â future or missing)</li>
<li>Critically evaluate different regression approaches</li>
</ol>
</div>
<div id="homework-9" class="section level2">
<h2><span class="header-section-number">10.2</span> Homework</h2>
<p>Outside of our schedulded sessions you should be doing around 12 hours of extra study per week. Feel free to follow your own GIS interests, but good places to start include the following:</p>
<div class="infobox assignment">
<p><strong>Assignment</strong></p>
<p>From weeks 10 until the assignment deadline, undertake your analysis, then write up your discussion and conclusion <strong>(that includes recommendations)</strong>.</p>
</div>
<div class="infobox tip">
<p><strong>Before submission</strong></p>
<p>Check that your assignment follows the standard model of scientific investigation. You may need to update your introduction and literature review based on the analysis you undertook to ensure a seamless narrative throughout.</p>
</div>
<div class="infobox note">
<p><strong>Reading</strong>
This week:</p>
<ul>
<li><p>For advanced R coding <a href="https://adv-r.hadley.nz/control-flow.html">Chapter 5 â€œControl flowâ€</a> from Advacned R by Hadley Wickham.</p></li>
<li><p>For more advanced R inclduing functions <a href="https://geocompr.robinlovelace.net/algorithms.html">Chapter 10 â€œScripts, algorithms and functionsâ€</a> from Geocomputation with R by Lovelace, Nowosad and Muenchow (2020).</p></li>
<li><p>For Ridge and LASSO regression <a href="https://bookdown.org/egarpor/PM-UC3M/lm-iii.html">Chapter 4 â€œLinear models III: shrinkage, multivariate response, and big dataâ€</a> from Predictive Modeling by PortuguÃ©s (2020).</p></li>
</ul>
<p>Remember this is just a starting point, explore the <a href="https://rl.talis.com/3/ucl/lists/139FBAF8-DACD-60FB-8BDC-E9C9E09BA885.html?lang=en-GB&amp;login=1">reading list</a>, practical and lecture for more ideas.</p>
</div>
</div>
<div id="recommended-listening-9" class="section level2">
<h2><span class="header-section-number">10.3</span> Recommended listening ðŸŽ§</h2>
<p>Some of these practicals are long, take regular breaks and have a listen to some of our fav tunes each week.</p>
<p><a href="https://www.youtube.com/watch?v=YNXybY2DtwM">Andy</a></p>
<p><a href="https://open.spotify.com/album/5yMqI30BaFZww5orpqemV5?si=vgEFH5p9ReqtGHSt66vCsw">Adam</a>6 letters: LSB, DRS. Oh yes!</p>
</div>
<div id="introduction-9" class="section level2">
<h2><span class="header-section-number">10.4</span> Introduction</h2>
<p>The Modifiable Areal Unit Problem (MAUP) represents the related effects of scale and aggregation on all geographic data and analysis. It was first deomstrated by the geographer Stan Openshaw in 1984 who showed that as you aggregated results to diffrent spatial units the reults could be manipulated to show different outcomes. Throughout this practical book weâ€™ve considered London boroughs, but would any of the results change if we considered the data at ward level? Are we hiding any trends because we have just used the borough data that summed all of the wards within the borough? Itâ€™s important to consider what is the most appropraite spatial unit for your analysis and provide appropraite reasoning. Even this is pretty straightforward (e.g.Â the data was only provided at the borough level) you must contextualise this and describe any potential limitations of it. In this practical i will firstly demonstrate the MAUP in action using some more advanced R code. Then we will have a look at some technqieus to model and validate data.</p>
<p>Here we will be using London brough and ward data from practical 1. As weâ€™re getting better with R, we will try to automate almost everthing â€” meaning that if you gave this code to someone else they could just run it without any data files and generate the same result. The only thing we wonâ€™t automate later on is loading an excel fileâ€¦ i did find a function online that would let us read it from the interweb but it was more hassle than it was worth. I donâ€™t know why the data isnâ€™t just also distributed as a <code>.csv</code>.</p>
</div>
<div id="maup" class="section level2">
<h2><span class="header-section-number">10.5</span> MAUP</h2>
<div id="get-the-data" class="section level3">
<h3><span class="header-section-number">10.5.1</span> Get the data</h3>
<ol style="list-style-type: decimal">
<li>Download and unzip the London statistical gis boundaries.</li>
</ol>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb596-1" title="1"><span class="co"># make a temp file to store the .zip in</span></a>
<a class="sourceLine" id="cb596-2" title="2"></a>
<a class="sourceLine" id="cb596-3" title="3"><span class="kw">download.file</span>(<span class="st">&quot;https://data.london.gov.uk/download/statistical-gis-boundary-files-london/9ba8c833-6370-4b11-abdc-314aa020d5e0/statistical-gis-boundaries-london.zip&quot;</span>, </a>
<a class="sourceLine" id="cb596-4" title="4">              <span class="dt">destfile=</span><span class="st">&quot;prac10_data/statistical-gis-boundaries-london.zip&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb597-2" title="2"><span class="kw">library</span>(fs)</a>
<a class="sourceLine" id="cb597-3" title="3">listfiles&lt;-<span class="kw">dir_info</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;prac10_data&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb597-4" title="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">str_detect</span>(path, <span class="st">&quot;statistical-gis-boundaries-london.zip&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb597-5" title="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(path)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb597-6" title="6"><span class="st">  </span><span class="kw">pull</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb597-7" title="7"><span class="st">  </span><span class="co">#print out the .gz file</span></a>
<a class="sourceLine" id="cb597-8" title="8"><span class="st">  </span><span class="kw">print</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb597-9" title="9"><span class="st">  </span><span class="kw">as.character</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb597-10" title="10"><span class="st">  </span>utils<span class="op">::</span><span class="kw">unzip</span>(<span class="dt">exdir=</span>here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;prac10_data&quot;</span>))</a></code></pre></div>
<pre><code>## C:/Users/Andy/OneDrive - University College London/Teaching/CASA0005/2020_2021/CASA0005repo/prac10_data/statistical-gis-boundaries-london.zip</code></pre>
<p>Using a recent update we could also change this a bit with the <code>pins()</code> package that downlaods and caches the url and automatically checks for file changes, only re-downloading if needed!</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" title="1"><span class="kw">library</span>(pins)</a>
<a class="sourceLine" id="cb599-2" title="2">pinexample&lt;-<span class="kw">pin</span>(<span class="st">&quot;https://data.london.gov.uk/download/statistical-gis-boundary-files-london/9ba8c833-6370-4b11-abdc-314aa020d5e0/statistical-gis-boundaries-london.zip&quot;</span>)</a></code></pre></div>
<p><code>pins()</code> also lets you share data easily, <a href="https://blog.rstudio.com/2019/09/09/pin-discover-and-share-resources/">have a look the RStudio pins blog post</a> for more information.</p>
<ol style="list-style-type: decimal">
<li>Take the downloaded data and filter it based on the filename that countains: Borough OR Ward_ AND <code>.shp</code> using <code>grepl()</code></li>
</ol>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" title="1">boroughsandwards&lt;-<span class="kw">dir_info</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;prac9_data&quot;</span>, </a>
<a class="sourceLine" id="cb600-2" title="2">                                 <span class="st">&quot;statistical-gis-boundaries-london&quot;</span>, </a>
<a class="sourceLine" id="cb600-3" title="3">                                 <span class="st">&quot;ESRI&quot;</span>))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb600-4" title="4"><span class="st">  </span><span class="co">#$ means exact match</span></a>
<a class="sourceLine" id="cb600-5" title="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">str_detect</span>(path, </a>
<a class="sourceLine" id="cb600-6" title="6">                        <span class="st">&quot;London_Ward_CityMerged.shp$|London_Borough_Excluding_MHW.shp$&quot;</span>))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb600-7" title="7"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(path)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb600-8" title="8"><span class="st">  </span><span class="kw">pull</span>()</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Now read in both of the files using <code>map()</code> that applies a function (here <code>st_read()</code> from the <code>sf</code> package) to a list. <code>map()</code> comes from the <code>purrr</code> package which extends Râ€™s functional programming ability.</li>
</ol>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" title="1"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb601-2" title="2">boroughsandwardssf&lt;-<span class="kw">map</span>(boroughsandwards, st_read)</a></code></pre></div>
<pre><code>## Reading layer `London_Borough_Excluding_MHW&#39; from data source `C:\Users\Andy\OneDrive - University College London\Teaching\CASA0005\2020_2021\CASA0005repo\prac9_data\statistical-gis-boundaries-london\ESRI\London_Borough_Excluding_MHW.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 33 features and 7 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## projected CRS:  OSGB 1936 / British National Grid
## Reading layer `London_Ward_CityMerged&#39; from data source `C:\Users\Andy\OneDrive - University College London\Teaching\CASA0005\2020_2021\CASA0005repo\prac9_data\statistical-gis-boundaries-london\ESRI\London_Ward_CityMerged.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 625 features and 7 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## projected CRS:  OSGB 1936 / British National Grid</code></pre>
<p>To map or access each individual shapefile itâ€™s justâ€¦</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" title="1"><span class="kw">library</span>(tmap)</a>
<a class="sourceLine" id="cb603-2" title="2"><span class="kw">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</a>
<a class="sourceLine" id="cb603-3" title="3"><span class="kw">qtm</span>(boroughsandwardssf[[<span class="dv">2</span>]]) </a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-477-1.png" width="672" /></p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" title="1"><span class="co"># or change to 1 </span></a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Get the data for Airbnb</li>
</ol>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" title="1">Airbnb &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;http://data.insideairbnb.com/united-kingdom/england/london/2019-07-10/visualisations/listings.csv&quot;</span>)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>And for OSM weâ€™ll download it from geofabrik, you can also use the OSM Application Programming Interface (API) but there is a limit on the number of points downloadable per call so youâ€™d have to do something a bit more complicated to get the whole of Londonâ€¦however, I have provided an example of the api call.</li>
</ol>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb606-1" title="1"><span class="kw">library</span>(memisc)</a>
<a class="sourceLine" id="cb606-2" title="2"><span class="kw">download.file</span>(<span class="st">&quot;http://download.geofabrik.de/europe/great-britain/england/greater-london-latest-free.shp.zip&quot;</span>,</a>
<a class="sourceLine" id="cb606-3" title="3">              <span class="dt">mode=</span><span class="st">&#39;wb&#39;</span>, </a>
<a class="sourceLine" id="cb606-4" title="4">              <span class="dt">destfile=</span><span class="st">&quot;prac10_data/geofabrik.zip&quot;</span>)</a>
<a class="sourceLine" id="cb606-5" title="5"></a>
<a class="sourceLine" id="cb606-6" title="6">listfiles&lt;-<span class="kw">dir_info</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;prac10_data&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb606-7" title="7"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">str_detect</span>(path, <span class="st">&quot;geofabrik.zip&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb606-8" title="8"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(path)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb606-9" title="9"><span class="st">  </span><span class="kw">pull</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb606-10" title="10"><span class="st">  </span><span class="co">#print out the .gz file</span></a>
<a class="sourceLine" id="cb606-11" title="11"><span class="st">  </span><span class="kw">print</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb606-12" title="12"><span class="st">  </span><span class="kw">as.character</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb606-13" title="13"><span class="st">  </span>utils<span class="op">::</span><span class="kw">unzip</span>(<span class="dt">exdir=</span>here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;prac10_data&quot;</span>, <span class="st">&quot;geofabrik&quot;</span>))</a></code></pre></div>
<p>Example of using the APIâ€¦.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" title="1"><span class="kw">library</span>(osmar)</a>
<a class="sourceLine" id="cb607-2" title="2">src &lt;-<span class="st"> </span><span class="kw">osmsource_api</span>(<span class="dt">url =</span> <span class="st">&quot;https://api.openstreetmap.org/api/0.6/&quot;</span>)</a>
<a class="sourceLine" id="cb607-3" title="3"><span class="co"># 1000 refers to distance from centre point</span></a>
<a class="sourceLine" id="cb607-4" title="4">bb &lt;-<span class="st"> </span><span class="kw">center_bbox</span>(<span class="op">-</span><span class="fl">0.112510</span>,<span class="fl">51.507627</span>, <span class="dv">1000</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb607-5" title="5">LDN &lt;-<span class="st"> </span><span class="kw">get_osm</span>(bb, <span class="dt">source =</span> src)</a>
<a class="sourceLine" id="cb607-6" title="6"><span class="kw">plot</span>(LDN)</a>
<a class="sourceLine" id="cb607-7" title="7"><span class="co"># extract just highwways</span></a>
<a class="sourceLine" id="cb607-8" title="8">ways &lt;-<span class="st"> </span><span class="kw">find</span>(LDN, <span class="kw">way</span>(<span class="kw">tags</span>(k <span class="op">==</span><span class="st"> &quot;highway&quot;</span>)))</a>
<a class="sourceLine" id="cb607-9" title="9">hway &lt;-<span class="st"> </span><span class="kw">find_down</span>(LDN, <span class="kw">way</span>(ways))</a>
<a class="sourceLine" id="cb607-10" title="10">hway &lt;-<span class="st"> </span><span class="kw">subset</span>(LDN, <span class="dt">ids =</span> hway)</a></code></pre></div>
</div>
<div id="project-the-data" class="section level3">
<h3><span class="header-section-number">10.5.2</span> Project the data</h3>
<ol style="list-style-type: decimal">
<li>Next up we need to project our <code>.shp</code> data â€¦we could project our data indiviudally using:</li>
</ol>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" title="1"><span class="kw">st_transform</span>(boroughsandwardssf[[<span class="dv">1</span>]], <span class="dv">27700</span>)</a>
<a class="sourceLine" id="cb608-2" title="2"><span class="kw">st_transform</span>(boroughsandwardssf[[<span class="dv">2</span>]], <span class="dv">27700</span>)</a></code></pre></div>
<p>or use <code>map()</code> againâ€¦</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" title="1">boroughsandwardssf&lt;-<span class="st"> </span><span class="kw">map</span>(boroughsandwardssf, <span class="dt">crs=</span><span class="dv">27700</span>, st_transform)</a>
<a class="sourceLine" id="cb609-2" title="2"></a>
<a class="sourceLine" id="cb609-3" title="3"><span class="co"># change the airbnb data to spatial </span></a>
<a class="sourceLine" id="cb609-4" title="4">Airbnb &lt;-<span class="st"> </span>Airbnb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb609-5" title="5"><span class="st">  </span><span class="kw">st_as_sf</span>(., <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), </a>
<a class="sourceLine" id="cb609-6" title="6">                   <span class="dt">crs =</span> <span class="dv">4326</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb609-7" title="7"><span class="st">  </span><span class="co"># project it too - remember that 27700 is</span></a>
<a class="sourceLine" id="cb609-8" title="8"><span class="st">  </span><span class="co"># British National Grid</span></a>
<a class="sourceLine" id="cb609-9" title="9"><span class="st">  </span><span class="kw">st_transform</span>(., <span class="dv">27700</span>)</a></code></pre></div>
</div>
<div id="functions-1" class="section level3">
<h3><span class="header-section-number">10.5.3</span> Functions</h3>
<ol style="list-style-type: decimal">
<li>Now remember our function we made for joining our Airbnb data (or Hotels) to the London boroughs layerâ€¦ letâ€™s make the fucntion againâ€¦</li>
</ol>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb610-1" title="1">Joinfun &lt;-<span class="st"> </span><span class="cf">function</span>(data1, data2){</a>
<a class="sourceLine" id="cb610-2" title="2"></a>
<a class="sourceLine" id="cb610-3" title="3">output&lt;-<span class="st"> </span>data1<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb610-4" title="4"><span class="st">  </span><span class="kw">st_join</span>(data2,.)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb610-5" title="5"><span class="st">  </span><span class="kw">add_count</span>(GSS_CODE, <span class="dt">name=</span><span class="st">&quot;airbnbs&quot;</span>) </a>
<a class="sourceLine" id="cb610-6" title="6">  <span class="kw">return</span>(output)</a>
<a class="sourceLine" id="cb610-7" title="7">}</a></code></pre></div>
</div>
<div id="loops" class="section level3">
<h3><span class="header-section-number">10.5.4</span> Loops</h3>
<ol style="list-style-type: decimal">
<li>Ok, but we want to get a count of Airbnb points per London ward and Boroughâ€¦how can we do that?â€¦well manually of courseâ€¦like thisâ€¦</li>
</ol>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb611-1" title="1">Airbnbborough &lt;-<span class="st"> </span><span class="kw">Joinfun</span>(Airbnb, boroughsandwardssf[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb611-2" title="2">Airbnbward &lt;-<span class="st"> </span><span class="kw">Joinfun</span>(Airbnb, boroughsandwardssf[[<span class="dv">2</span>]])</a></code></pre></div>
<p>But we can also autmoate this using a loop (either a while or for loop). Iâ€™ve used a while loop here as when i did my MSc you werenâ€™t able to put a for loop inside a for loop. I beleive that has now changed but because of that one day i had to spend changing everything i always default to using a while loop.</p>
<p>Tell us what a loop is aleady?</p>
<p>A loop letâ€™s you go over something adding 1 (or any value) each timeâ€¦for example letâ€™s look a basic loop. You need to run everything in the loop at once from the while to the }. If you make just a normal Rscript you can set breakpoints â€” the code will the stop each time it hits the breakpoint within the loop. You canâ€™t do this at the moment with RMarkdown code chunks, i normally develop the loop outside of it looping then put it all together.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb612-1" title="1"><span class="co"># set up a variable  </span></a>
<a class="sourceLine" id="cb612-2" title="2">basicloop &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb612-3" title="3"><span class="co"># so while our variable is less than </span></a>
<a class="sourceLine" id="cb612-4" title="4"><span class="co">#6 run the following code within the {}</span></a>
<a class="sourceLine" id="cb612-5" title="5"><span class="cf">while</span> (basicloop <span class="op">&lt;</span><span class="st"> </span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb612-6" title="6">  <span class="co">#print the varaible (starts at 1)</span></a>
<a class="sourceLine" id="cb612-7" title="7">  <span class="kw">print</span>(basicloop)</a>
<a class="sourceLine" id="cb612-8" title="8">  <span class="co"># then add 1 to the variable</span></a>
<a class="sourceLine" id="cb612-9" title="9">  basicloop =<span class="st"> </span>basicloop<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb612-10" title="10">  <span class="co"># go back to the start of the loop</span></a>
<a class="sourceLine" id="cb612-11" title="11">  <span class="co">#and if it is still &lt;6 run again</span></a>
<a class="sourceLine" id="cb612-12" title="12">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<p>That loop outputs the values of 1-5, as we started with a value of 1, then added 1 to make 2. It remained below 6 so the code ran again printing the 2 then added 1 again to make 3 and so on. As we specified less than 6 it stopped there..</p>
<p>We can also save these results to diffrent variables but we need to make a list (or dataframe/ whatever you need) to start with to save them in</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb614-1" title="1"><span class="co"># here is my empty list</span></a>
<a class="sourceLine" id="cb614-2" title="2">emptylist &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb614-3" title="3">  </a>
<a class="sourceLine" id="cb614-4" title="4">basicloop &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb614-5" title="5"></a>
<a class="sourceLine" id="cb614-6" title="6"><span class="cf">while</span> (basicloop <span class="op">&lt;</span><span class="st"> </span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb614-7" title="7">  <span class="kw">print</span>(basicloop)</a>
<a class="sourceLine" id="cb614-8" title="8">  emptylist[[basicloop]] &lt;-<span class="st"> </span>basicloop</a>
<a class="sourceLine" id="cb614-9" title="9">  basicloop &lt;-<span class="st"> </span>basicloop<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb614-10" title="10">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<p>Here we are using the varaible <code>basicloop</code> to index our emptylist.. so everytime we add 1 it changes the index valueâ€¦.have a look what i meanâ€¦</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" title="1">emptylist</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 4
## 
## [[5]]
## [1] 5</code></pre>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" title="1">emptylist[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb620-1" title="1">emptylist[[<span class="dv">2</span>]]</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>Right, so how are we going to apply this to our data. We have two <code>.shp</code> files (boroughs and wards) in a list that we want to apply our function to..</p>
<p>Firstly letâ€™s set up the length to stop at, make an empty list and a starting point. As our data is in a list we just want the length of that (as a number)..</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" title="1"><span class="co"># get the length - add 1 as we are using less than</span></a>
<a class="sourceLine" id="cb622-2" title="2">boroughlen&lt;-<span class="kw">length</span>(boroughsandwardssf)<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb622-3" title="3"><span class="co"># empty list</span></a>
<a class="sourceLine" id="cb622-4" title="4">hold&lt;-<span class="kw">list</span>()</a>
<a class="sourceLine" id="cb622-5" title="5"><span class="co"># here is our starting point variable</span></a>
<a class="sourceLine" id="cb622-6" title="6">i&lt;-<span class="dv">1</span></a></code></pre></div>
<p>Now here is the loop..</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" title="1"><span class="co"># while i is less than boroughlength </span></a>
<a class="sourceLine" id="cb623-2" title="2"><span class="co"># max of boroughlength is 3</span></a>
<a class="sourceLine" id="cb623-3" title="3"><span class="cf">while</span> (i <span class="op">&lt;</span><span class="st"> </span>boroughlen){</a>
<a class="sourceLine" id="cb623-4" title="4">  <span class="co"># put the output in our varible</span></a>
<a class="sourceLine" id="cb623-5" title="5">  <span class="co"># use the function for boroughs and then wards</span></a>
<a class="sourceLine" id="cb623-6" title="6">  hold[[i]] &lt;-<span class="st"> </span><span class="kw">Joinfun</span>(Airbnb, boroughsandwardssf[[i]])</a>
<a class="sourceLine" id="cb623-7" title="7">  <span class="co"># add one to the index</span></a>
<a class="sourceLine" id="cb623-8" title="8">  i&lt;-i<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb623-9" title="9">}</a>
<a class="sourceLine" id="cb623-10" title="10"></a>
<a class="sourceLine" id="cb623-11" title="11"><span class="co"># make a quick thematic map to have a look</span></a>
<a class="sourceLine" id="cb623-12" title="12">justairbnbborough&lt;-hold[[<span class="dv">1</span>]]<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-13" title="13"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(GSS_CODE, airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-14" title="14"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-15" title="15"><span class="st">  </span><span class="kw">distinct</span>(GSS_CODE, airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-16" title="16"><span class="st">  </span><span class="kw">left_join</span>(boroughsandwardssf[[<span class="dv">1</span>]], .,</a>
<a class="sourceLine" id="cb623-17" title="17">                        <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;GSS_CODE&quot;</span> =<span class="st"> &quot;GSS_CODE&quot;</span>))</a>
<a class="sourceLine" id="cb623-18" title="18"></a>
<a class="sourceLine" id="cb623-19" title="19">justairbnward&lt;-hold[[<span class="dv">2</span>]]<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-20" title="20"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(GSS_CODE, airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-21" title="21"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-22" title="22"><span class="st">  </span><span class="kw">distinct</span>(GSS_CODE, airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-23" title="23"><span class="st">  </span><span class="kw">left_join</span>(boroughsandwardssf[[<span class="dv">2</span>]], .,</a>
<a class="sourceLine" id="cb623-24" title="24">                        <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;GSS_CODE&quot;</span> =<span class="st"> &quot;GSS_CODE&quot;</span>))</a>
<a class="sourceLine" id="cb623-25" title="25"></a>
<a class="sourceLine" id="cb623-26" title="26"><span class="kw">qtm</span>(justairbnbborough, <span class="dt">fill =</span> <span class="st">&quot;airbnbs&quot;</span>)</a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-489-1.png" width="672" /></p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb624-1" title="1"><span class="kw">qtm</span>(justairbnward, <span class="dt">fill =</span> <span class="st">&quot;airbnbs&quot;</span>)</a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-489-2.png" width="672" /></p>
<p>When should i use a loop?</p>
<p>Well thatâ€™s a hard questionâ€¦generally loops used to be considered inefficient in R, but iâ€™m yet to come across a method that will let you increment one varibale whilst keeping another consistent â€¦by this i mean like what we did in our loop. We changed what spatial data was joined with the Airbnb data â€” the Airbnb data remained the same. There are a few other functions like <code>mapply()</code>, <code>sapply()</code> and <code>tapply()</code> that work in the same format as <code>lapply()</code> but to my knowledge they still will increment all of the variables at the same time.</p>
<p>In terms of code clarity iâ€™m going to refer to <a href="https://r4ds.had.co.nz/iteration.html">section 21.5 on iteration</a> in Wickham $ Grolemund (2017)â€¦</p>
<blockquote>
<p>â€œSome people will tell you to avoid for loops because they are slow. Theyâ€™re wrong! (Well at least theyâ€™re rather out of date, as for loops havenâ€™t been slow for many years). The chief benefits of using â€˜other functionsâ€™ is not speed, but clarity: they make your code easier to write and to readâ€.</p>
</blockquote>
<p>That said, within this course you are not marked on how â€˜goodâ€™ or â€˜efficientâ€™ your code is. Sure, i want you to write great code, but if you are writing code for your assigment or any future project really, my advice is the same. Get something that works and addresses the mark scheme (read the mark scheme!) and then if you have time, improve it later on. There is also a section later on about writing advanced code in the assignment.</p>
</div>
<div id="advanced-mapping-again" class="section level3">
<h3><span class="header-section-number">10.5.5</span> Advanced mapping (again)</h3>
<ol style="list-style-type: decimal">
<li>Right, so we can sort of see the difference between the spatial levels (boroughs and wards) but letâ€™s take a closer look within Westminsterâ€¦ here is the â€˜preambleâ€™ for the <code>leaflet</code> map â€¦basically all the stuff we need to set it upâ€¦</li>
</ol>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" title="1"><span class="kw">library</span>(classInt)</a>
<a class="sourceLine" id="cb625-2" title="2"><span class="kw">library</span>(leaflet)</a>
<a class="sourceLine" id="cb625-3" title="3"><span class="kw">library</span>(leafpop)</a>
<a class="sourceLine" id="cb625-4" title="4"></a>
<a class="sourceLine" id="cb625-5" title="5"><span class="co"># extract only westminster from boroughs</span></a>
<a class="sourceLine" id="cb625-6" title="6"></a>
<a class="sourceLine" id="cb625-7" title="7">Borough &lt;-<span class="st"> </span>hold[[<span class="dv">1</span>]] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-8" title="8"><span class="st">  </span><span class="kw">filter</span>(NAME<span class="op">==</span><span class="st">&quot;Westminster&quot;</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-9" title="9"><span class="st">  </span><span class="co"># we need to set the projection to WGS84</span></a>
<a class="sourceLine" id="cb625-10" title="10"><span class="st">  </span><span class="co"># to use with leaflet</span></a>
<a class="sourceLine" id="cb625-11" title="11"><span class="st">  </span><span class="kw">st_transform</span>(., <span class="dt">crs=</span><span class="dv">4326</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-12" title="12"><span class="st">  </span><span class="co">#at the moment each airbnb is a row for the borough</span></a>
<a class="sourceLine" id="cb625-13" title="13"><span class="st">  </span><span class="co">#we just one one row that has number of airbnbs</span></a>
<a class="sourceLine" id="cb625-14" title="14"><span class="st">  </span><span class="kw">group_by</span>(., GSS_CODE, NAME)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-15" title="15"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">airbnbs =</span> <span class="kw">unique</span>(airbnbs))</a>
<a class="sourceLine" id="cb625-16" title="16">  </a>
<a class="sourceLine" id="cb625-17" title="17">wardsatborough &lt;-<span class="st"> </span>hold[[<span class="dv">2</span>]] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-18" title="18"><span class="st">  </span><span class="kw">filter</span>(BOROUGH<span class="op">==</span><span class="st">&quot;Westminster&quot;</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-19" title="19"><span class="st">  </span><span class="co"># we need to set the projection to WGS84</span></a>
<a class="sourceLine" id="cb625-20" title="20"><span class="st">  </span><span class="co"># to use with leaflet</span></a>
<a class="sourceLine" id="cb625-21" title="21"><span class="st">  </span><span class="kw">st_transform</span>(., <span class="dt">crs=</span><span class="dv">4326</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-22" title="22"><span class="st">  </span><span class="co">#at the moment each airbnb is a row for the wards</span></a>
<a class="sourceLine" id="cb625-23" title="23"><span class="st">  </span><span class="co">#we just one one row that has number of airbnbs</span></a>
<a class="sourceLine" id="cb625-24" title="24"><span class="st">  </span><span class="kw">group_by</span>(., GSS_CODE, NAME)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-25" title="25"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">airbnbs =</span> <span class="kw">unique</span>(airbnbs))</a>
<a class="sourceLine" id="cb625-26" title="26"></a>
<a class="sourceLine" id="cb625-27" title="27"><span class="co"># set our breaks for the map</span></a>
<a class="sourceLine" id="cb625-28" title="28">breaks1&lt;-<span class="kw">classIntervals</span>(hold[[<span class="dv">1</span>]]<span class="op">$</span>airbnbs, </a>
<a class="sourceLine" id="cb625-29" title="29">                        <span class="dt">n=</span><span class="dv">5</span>, </a>
<a class="sourceLine" id="cb625-30" title="30">                        <span class="dt">style =</span> <span class="st">&quot;quantile&quot;</span>)</a>
<a class="sourceLine" id="cb625-31" title="31">breaks2&lt;-<span class="kw">classIntervals</span>(wardsatborough<span class="op">$</span>airbnbs, </a>
<a class="sourceLine" id="cb625-32" title="32">                        <span class="dt">n=</span><span class="dv">5</span>, </a>
<a class="sourceLine" id="cb625-33" title="33">                        <span class="dt">style =</span> <span class="st">&quot;quantile&quot;</span>)</a>
<a class="sourceLine" id="cb625-34" title="34"></a>
<a class="sourceLine" id="cb625-35" title="35"><span class="co"># use the breaks to set our colour palettes</span></a>
<a class="sourceLine" id="cb625-36" title="36">pal &lt;-<span class="st"> </span><span class="kw">colorBin</span>(<span class="dt">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, </a>
<a class="sourceLine" id="cb625-37" title="37">                <span class="dt">domain=</span>hold[[<span class="dv">1</span>]]<span class="op">$</span>airbnbs, </a>
<a class="sourceLine" id="cb625-38" title="38">                <span class="dt">bins=</span>breaks1<span class="op">$</span>brks)</a>
<a class="sourceLine" id="cb625-39" title="39">pal2 &lt;-<span class="st"> </span><span class="kw">colorBin</span>(<span class="dt">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, </a>
<a class="sourceLine" id="cb625-40" title="40">                 <span class="dt">domain=</span>wardsatborough<span class="op">$</span>airbnbs, </a>
<a class="sourceLine" id="cb625-41" title="41">                 <span class="dt">bins=</span>breaks2<span class="op">$</span>brks)</a>
<a class="sourceLine" id="cb625-42" title="42"></a>
<a class="sourceLine" id="cb625-43" title="43"><span class="co"># we want a popup of information too</span></a>
<a class="sourceLine" id="cb625-44" title="44"><span class="co"># here we make a new varaible with no </span></a>
<a class="sourceLine" id="cb625-45" title="45"><span class="co">#spatial info (remove geometry)</span></a>
<a class="sourceLine" id="cb625-46" title="46"></a>
<a class="sourceLine" id="cb625-47" title="47">wardinfo &lt;-wardsatborough <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-48" title="48"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-49" title="49"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">Ward =</span> NAME,</a>
<a class="sourceLine" id="cb625-50" title="50">         <span class="dt">Airbnbs =</span> airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-51" title="51"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Ward, Airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-52" title="52"><span class="st">  </span><span class="kw">popupTable</span>()</a>
<a class="sourceLine" id="cb625-53" title="53"></a>
<a class="sourceLine" id="cb625-54" title="54">boroughinfo &lt;-wardsatborough <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-55" title="55"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-56" title="56"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">Borough =</span> NAME,</a>
<a class="sourceLine" id="cb625-57" title="57">         <span class="dt">Airbnbs =</span> airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-58" title="58"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Borough, Airbnbs)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb625-59" title="59"><span class="st">  </span><span class="kw">popupTable</span>()</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Now letâ€™s map it using what we just specifiedâ€¦ iâ€™ve added a few more features than were in the <a href="map-making.html#map-making">Map making</a> practical</li>
</ol>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb626-1" title="1">  wardandboroughs&lt;-<span class="st"> </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-2" title="2"><span class="st">    </span><span class="co"># add basemap options</span></a>
<a class="sourceLine" id="cb626-3" title="3"><span class="st">    </span><span class="kw">addProviderTiles</span>(providers<span class="op">$</span>Stamen.TonerLite, <span class="dt">group =</span> <span class="st">&quot;Toner Lite&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-4" title="4"><span class="st">    </span><span class="kw">addTiles</span>(<span class="dt">group =</span> <span class="st">&quot;OSM&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-5" title="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb626-6" title="6"><span class="st">    </span><span class="co">#add our Borough polygons, linking to the tables we just made</span></a>
<a class="sourceLine" id="cb626-7" title="7"><span class="st">    </span><span class="kw">addPolygons</span>(<span class="dt">data=</span>Borough,</a>
<a class="sourceLine" id="cb626-8" title="8">                <span class="dt">color=</span><span class="st">&quot;white&quot;</span>, </a>
<a class="sourceLine" id="cb626-9" title="9">                <span class="dt">weight =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb626-10" title="10">                <span class="dt">opacity =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb626-11" title="11">                <span class="dt">dashArray =</span> <span class="st">&quot;3&quot;</span>,</a>
<a class="sourceLine" id="cb626-12" title="12">                <span class="dt">fillOpacity =</span> <span class="fl">0.7</span>,</a>
<a class="sourceLine" id="cb626-13" title="13">                <span class="dt">popup =</span> boroughinfo,</a>
<a class="sourceLine" id="cb626-14" title="14">                <span class="dt">fillColor =</span> <span class="op">~</span><span class="kw">pal</span>(Borough<span class="op">$</span>airbnbs),</a>
<a class="sourceLine" id="cb626-15" title="15">                <span class="dt">group =</span> <span class="st">&quot;Borough&quot;</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-16" title="16"><span class="st">    </span></a>
<a class="sourceLine" id="cb626-17" title="17"><span class="st">    </span><span class="co">#add our ward polygons, linking to the tables we just made</span></a>
<a class="sourceLine" id="cb626-18" title="18"><span class="st">    </span><span class="kw">addPolygons</span>(<span class="dt">data=</span>wardsatborough,</a>
<a class="sourceLine" id="cb626-19" title="19">                <span class="dt">color=</span><span class="st">&quot;white&quot;</span>, </a>
<a class="sourceLine" id="cb626-20" title="20">                <span class="dt">weight =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb626-21" title="21">                <span class="dt">opacity =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb626-22" title="22">                <span class="dt">dashArray =</span> <span class="st">&quot;3&quot;</span>,</a>
<a class="sourceLine" id="cb626-23" title="23">                <span class="dt">fillOpacity =</span> <span class="fl">0.7</span>,</a>
<a class="sourceLine" id="cb626-24" title="24">                <span class="dt">popup =</span> wardinfo,</a>
<a class="sourceLine" id="cb626-25" title="25">                <span class="dt">fillColor =</span> <span class="op">~</span><span class="kw">pal2</span>(wardsatborough<span class="op">$</span>airbnbs),</a>
<a class="sourceLine" id="cb626-26" title="26">                <span class="dt">group =</span> <span class="st">&quot;Wards&quot;</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-27" title="27"><span class="st">  </span></a>
<a class="sourceLine" id="cb626-28" title="28"><span class="st">    </span><span class="co"># add a legend for wards</span></a>
<a class="sourceLine" id="cb626-29" title="29"><span class="st">    </span><span class="kw">addLegend</span>(<span class="dt">pal =</span> pal2, </a>
<a class="sourceLine" id="cb626-30" title="30">              <span class="dt">values =</span> wardsatborough<span class="op">$</span>airbnbs,</a>
<a class="sourceLine" id="cb626-31" title="31">              <span class="dt">group=</span><span class="kw">c</span>(<span class="st">&quot;Wards&quot;</span>), </a>
<a class="sourceLine" id="cb626-32" title="32">              <span class="dt">position =</span><span class="st">&quot;bottomleft&quot;</span>,</a>
<a class="sourceLine" id="cb626-33" title="33">              <span class="dt">title =</span><span class="st">&quot;Accom count&quot;</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-34" title="34"><span class="st">     </span></a>
<a class="sourceLine" id="cb626-35" title="35"><span class="st">    </span><span class="co"># add a legend for boroughs</span></a>
<a class="sourceLine" id="cb626-36" title="36"><span class="st">    </span><span class="kw">addLegend</span>(<span class="dt">pal =</span> pal, </a>
<a class="sourceLine" id="cb626-37" title="37">              <span class="dt">values =</span> Borough,</a>
<a class="sourceLine" id="cb626-38" title="38">              <span class="dt">group=</span><span class="kw">c</span>(<span class="st">&quot;Borough&quot;</span>), </a>
<a class="sourceLine" id="cb626-39" title="39">              <span class="dt">title =</span><span class="st">&quot;Accom count&quot;</span>,</a>
<a class="sourceLine" id="cb626-40" title="40">              <span class="dt">position =</span><span class="st">&quot;bottomleft&quot;</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-41" title="41"><span class="st">  </span></a>
<a class="sourceLine" id="cb626-42" title="42"><span class="st">  </span><span class="co"># specify layers control</span></a>
<a class="sourceLine" id="cb626-43" title="43"><span class="st">  </span><span class="kw">addLayersControl</span>(</a>
<a class="sourceLine" id="cb626-44" title="44">    <span class="dt">baseGroups =</span> <span class="kw">c</span>(<span class="st">&quot;Toner Lite&quot;</span>, <span class="st">&quot;OSM&quot;</span>),</a>
<a class="sourceLine" id="cb626-45" title="45">    <span class="dt">overlayGroups =</span> <span class="kw">c</span>(<span class="st">&quot;Borough&quot;</span>, <span class="st">&quot;Wards&quot;</span>),</a>
<a class="sourceLine" id="cb626-46" title="46">    <span class="dt">options =</span> <span class="kw">layersControlOptions</span>(<span class="dt">collapsed =</span> <span class="ot">FALSE</span>))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb626-47" title="47"><span class="st">    </span><span class="kw">hideGroup</span>(<span class="kw">c</span>(<span class="st">&quot;Borough&quot;</span>))</a>
<a class="sourceLine" id="cb626-48" title="48"></a>
<a class="sourceLine" id="cb626-49" title="49"><span class="co"># show us the map</span></a>
<a class="sourceLine" id="cb626-50" title="50">wardandboroughs</a></code></pre></div>
<p>Have a look around the mapâ€¦Westminster borough uses a scale considering all other London borough values, whilst the ward scale is specific to Westminster. Use the following code to explore the valuesâ€¦</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb627-1" title="1"><span class="co"># range of Airbnbs per ward in Westminster</span></a>
<a class="sourceLine" id="cb627-2" title="2"></a>
<a class="sourceLine" id="cb627-3" title="3">Range&lt;-wardsatborough <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb627-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Max =</span> <span class="kw">max</span>(airbnbs),</a>
<a class="sourceLine" id="cb627-5" title="5">            <span class="dt">Min =</span> <span class="kw">min</span> (airbnbs))</a></code></pre></div>
</div>
</div>
<div id="regression-relationships" class="section level2">
<h2><span class="header-section-number">10.6</span> Regression relationships</h2>
<blockquote>
<p><strong>Warning</strong> The data used within this practical is purely for demonstration purposes!</p>
</blockquote>
<div id="preprocessing" class="section level3">
<h3><span class="header-section-number">10.6.1</span> Preprocessing</h3>
<p>In this part of the practical weâ€™re going to try and model the relationship between the Airbnb counts at ward level and other variables. Our mini investagion here would be to see if itâ€™s possible to produce a statisitcally valid and rigorous model for predicting Airbnb values at the ward level. This type of analysis might be useful if you had missing or limited data at one spatial level (e.g.Â wards) but had a more complete dataset at a larger spatial scale (e.g.Â boroughs). Essentially, weâ€™re trying to use the data at the borough level to give us an estiamte of the data at the ward level. Obviously this isnâ€™t an issue for us here but if you ever use survey data or any kind of count data (e.g.Â health) if may well be limited to specific areasâ€¦</p>
<p>This section will also show you how to make/ use different regression models in R. Regression aims to find a mathematical equation to predict a value (in this case Airbnb at ward level) from one (or more) predictor variables (e.g.Â borough data). So weâ€™ll use values of X (borough data) to predict values of Y (ward data)â€¦</p>
<p><img src="prac10_images/linear_regression.png" width="400" style="display: block; margin: auto;" /></p>
<p>This can be represented with the equation:</p>
<p><span class="math display">\[Y = \beta_{1} + \beta_{2} X + \epsilon\]</span>
Where <span class="math inline">\(\beta_{1}\)</span> is the intercept (expected value of Y when X=0, also called bias in machine learning), <span class="math inline">\(\beta_{2}\)</span> is the slope of the line and <span class="math inline">\(\epsilon\)</span> is the error term, the part that the model is unable to explain (and variables are not included)â€¦Here we would call the intercept and slop coefficients.</p>
<ol style="list-style-type: decimal">
<li>To start with weâ€™re going to crop our wards data to our boroughs data. In the borough data you can see the river Thames which isnâ€™t in the wards data. I donâ€™t think this is technically required, but itâ€™s good practice to make sure you datasets align and if they donâ€™t to do something about itâ€¦</li>
</ol>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb628-1" title="1"><span class="kw">library</span>(tmaptools)</a>
<a class="sourceLine" id="cb628-2" title="2"></a>
<a class="sourceLine" id="cb628-3" title="3">cropped &lt;-<span class="st"> </span>justairbnbborough <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb628-4" title="4"><span class="st">  </span><span class="kw">crop_shape</span>(justairbnward,., <span class="dt">polygon =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb628-5" title="5"></a>
<a class="sourceLine" id="cb628-6" title="6"><span class="co"># something like this would just extract the </span></a>
<a class="sourceLine" id="cb628-7" title="7"><span class="co"># values within the shape, but not clip like a cookie cutter</span></a>
<a class="sourceLine" id="cb628-8" title="8"><span class="co"># we want to use the borough layer to cut out the river from </span></a>
<a class="sourceLine" id="cb628-9" title="9"><span class="co"># the wards layer</span></a>
<a class="sourceLine" id="cb628-10" title="10"><span class="co">###test &lt;- hold[[2]][hold[[1]],]</span></a>
<a class="sourceLine" id="cb628-11" title="11"></a>
<a class="sourceLine" id="cb628-12" title="12"><span class="co"># check it worked, you should be </span></a>
<a class="sourceLine" id="cb628-13" title="13"><span class="co">#able to see the river</span></a>
<a class="sourceLine" id="cb628-14" title="14"></a>
<a class="sourceLine" id="cb628-15" title="15"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(cropped))</a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-494-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li>Now we need to join our wards data and borough data togther to give us a borough value for each ward withinâ€¦</li>
</ol>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" title="1"><span class="co"># join wards and boroughs</span></a>
<a class="sourceLine" id="cb629-2" title="2"></a>
<a class="sourceLine" id="cb629-3" title="3">joined &lt;-<span class="st"> </span>justairbnbborough <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb629-4" title="4"><span class="st">  </span><span class="kw">st_join</span>(., justairbnward, <span class="dt">join=</span>st_contains)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb629-5" title="5"><span class="st">  </span><span class="kw">rename</span>(., <span class="dt">Boroughcount =</span> airbnbs.x, </a>
<a class="sourceLine" id="cb629-6" title="6">         <span class="dt">Wardcount =</span> airbnbs.y)</a></code></pre></div>
</div>
<div id="scatter-plot" class="section level3">
<h3><span class="header-section-number">10.6.2</span> Scatter plot</h3>
<ol style="list-style-type: decimal">
<li>To start with letâ€™s just visualise the relationship between the borough an ward count using a scatter plot. If you have multiple predictor variables (explied later on) a plot will be drawn for each of themâ€¦</li>
</ol>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb630-1" title="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(joined, <span class="kw">aes</span>(Boroughcount, Wardcount))<span class="op">+</span></a>
<a class="sourceLine" id="cb630-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb630-3" title="3"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Borough count&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb630-4" title="4"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Ward count&quot;</span>)</a></code></pre></div>
<p>The scatter plot shows some kind of linear relationship. The point variation around borough count is beacuse for each borough the wards will have a range of valuesâ€¦like we saw in the interactive mapâ€¦Westminster borough had a value of 9410 and the wards ranged from 159 to 1215</p>
</div>
<div id="outliers" class="section level3">
<h3><span class="header-section-number">10.6.3</span> Outliers</h3>
<ol style="list-style-type: decimal">
<li>Generally any point that is outside 1.5* the interquartile-range (or IQR) is considered an outlier (a data point that differs significantly from all others) and you could use something like the methods here to remove and replace themâ€¦the IQR is the distance between the 25th and 75th percentile..</li>
</ol>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))  <span class="co"># divide graph area in 2 columns</span></a>
<a class="sourceLine" id="cb631-2" title="2"></a>
<a class="sourceLine" id="cb631-3" title="3"><span class="kw">boxplot</span>(joined<span class="op">$</span>Boroughcount, <span class="dt">main=</span><span class="st">&quot;Boroughs&quot;</span>)</a>
<a class="sourceLine" id="cb631-4" title="4"><span class="kw">boxplot</span>(joined<span class="op">$</span>Wardcount, <span class="dt">main=</span><span class="st">&quot;Wards&quot;</span>)</a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-497-1.png" width="672" /></p>
<blockquote>
<p><strong>Warning</strong> The data used within this practical is purely for demonstration purposes! These box plots indicate that our data is not normally distributed so you might want to refer to the assumptions in last weekâ€™s practical if you were to do this propperly.</p>
</blockquote>
</div>
<div id="correlation" class="section level3">
<h3><span class="header-section-number">10.6.4</span> Correlation</h3>
<ol style="list-style-type: decimal">
<li>Correlation letâ€™s use see the level of linear dependence between two varaibles between -1 and 1. High values (towards 1) mean that for every x instance there is an increase in y. Low values (towards -1) mean the opposite.</li>
</ol>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" title="1"><span class="kw">library</span>(corrr)</a>
<a class="sourceLine" id="cb632-2" title="2"></a>
<a class="sourceLine" id="cb632-3" title="3">Correlation &lt;-<span class="st"> </span>joined <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb632-4" title="4"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb632-5" title="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Boroughcount,</a>
<a class="sourceLine" id="cb632-6" title="6">                Wardcount)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb632-7" title="7"><span class="st">    </span><span class="kw">correlate</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb632-8" title="8"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   rowname      Boroughcount Wardcount
##   &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;
## 1 Boroughcount       NA         0.789
## 2 Wardcount           0.789    NA</code></pre>
<ol style="list-style-type: decimal">
<li>Looks, like weâ€™ve got a strong relationship.</li>
</ol>
</div>
<div id="linear-model" class="section level3">
<h3><span class="header-section-number">10.6.5</span> Linear model</h3>
<ol style="list-style-type: decimal">
<li>Now letâ€™s use a linear model to establish a relationship between predictor and response with the function <code>lm()</code>. Here we are calling the <code>lm()(then stating the Formula, then the data)</code></li>
</ol>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" title="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb634-2" title="2">linearMod &lt;-<span class="st"> </span><span class="kw">lm</span>(Wardcount <span class="op">~</span><span class="st"> </span></a>
<a class="sourceLine" id="cb634-3" title="3"><span class="st">                  </span>Boroughcount, </a>
<a class="sourceLine" id="cb634-4" title="4">                <span class="dt">data=</span>joined)</a>
<a class="sourceLine" id="cb634-5" title="5"></a>
<a class="sourceLine" id="cb634-6" title="6"><span class="kw">tidy</span>(linearMod)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term         estimate std.error statistic   p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)  -10.9      6.20        -1.76 7.97e-  2
## 2 Boroughcount   0.0550   0.00182     30.2  2.68e-119</code></pre>
<p>So from this output we have the coefficients of intercept and Boroughcount, going back to our formula from earlier this would meanâ€¦</p>
<p><span class="math display">\[Wardcount = -3.8188 + 0.0541*Boroughcount\]</span></p>
</div>
<div id="linear-model-outputs" class="section level3">
<h3><span class="header-section-number">10.6.6</span> Linear model outputs</h3>
<p><strong>Coefficient Estimates</strong></p>
<p>Our intercept, the expected value of Y when X=0 is -3.8 and slope is 0.054.</p>
<p><strong>Standard error</strong></p>
<p>The coefficient standard error represents the average amount that coeffieint estimates vary from the average of our response. It basically shows the expected range if we were to model again and again. So here, for a 1% increase in the number of Airbnbs per ward by 0.05, but this might vary by 0.001. Ideally the standard error is lower than the size of the coeffeicient (0.001 is lower the 0.05)</p>
<p><strong>p-value</strong></p>
<p>A linear model is only statistically significant when both p-values are &lt;0.05 within the summary call. There are two values as one if for the coefficient (is the specific coefficient significant) and the other is for the model (is the model significant). Here as they both are, this would allow us to accept the alternative hypothesis that the coefficients are not equal to 0 (and therefore there is a relationship between the independent and dependent variabile).</p>
<p><strong>R-squared</strong></p>
<p>R squared represents the proportion of variance of the dependent variable that is explained by the independent. It is different from correlation as that is the strength of the relationship!!! R squared is often referred to as â€˜goodness-of-fitâ€™. Here 61% of the variance in Airbnb ward count can be explained by the varaition in Airbnb borough count.</p>
<p>But there are a few issues with R squared â€” every time you add a predictor to the model R squared will increase and if there are too many predictors it will model random noise</p>
<p><strong>Adjusted R squared</strong></p>
<p>Adjusted R squared consideres the number of variables within the model, increasing only if the new term assits by more than just chance.</p>
<p><strong>t</strong></p>
<p>Coefficient t shows how many standard deviations the coefficient estaimte is away from 0 â€” the further away means the more likely we can reject the null hypothesis. It is calcaulted by dividing the value of the coeffeicient by the standard error</p>
<p><strong>Residual error</strong></p>
<p>Residual standard error is a measure of the quality of fit of the linear regression line. It is an average of the error that the points differ out from the line.</p>
<p><strong>F</strong></p>
<p>F-statistcs, basically, the futher from 1 the better it is.</p>
<p>See <a href="https://feliperego.github.io/blog/2015/10/23/Interpreting-Model-Output-In-R">this guide</a> for more information on the outputs</p>
<p>Remember the formula produced from the regression equation, well we can also extract this automatically â€¦to make that original formula in RMarkdown I used this (not within a code chunk)â€¦.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb636-1" title="1"><span class="op">$</span><span class="er">$</span>Wardcount =<span class="st"> </span><span class="fl">-3.8188</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.0541</span><span class="op">*</span>Boroughcount<span class="op">$</span><span class="er">$</span></a></code></pre></div>
<p>But we can also extract it directly using a new package from GitHubâ€¦</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb637-1" title="1"><span class="co"># load remotes so we can get the new package</span></a>
<a class="sourceLine" id="cb637-2" title="2"><span class="kw">library</span>(remotes)</a></code></pre></div>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb638-1" title="1"><span class="co"># get the new package equatiomatic()</span></a>
<a class="sourceLine" id="cb638-2" title="2">remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;datalorax/equatiomatic&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb639-1" title="1"><span class="co"># load it</span></a>
<a class="sourceLine" id="cb639-2" title="2"><span class="kw">library</span>(equatiomatic)</a>
<a class="sourceLine" id="cb639-3" title="3"><span class="co"># extract the info to make the equation</span></a>
<a class="sourceLine" id="cb639-4" title="4"><span class="kw">extract_eq</span>(linearMod)</a></code></pre></div>
<pre><code>## $$
## \text{Wardcount} = \alpha + \beta_{1}(\text{Boroughcount}) + \epsilon
## $$</code></pre>
<p>Play around with line length and use the actual coefficient names</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb641-1" title="1"><span class="kw">extract_eq</span>(linearMod, <span class="dt">use_coefs =</span> <span class="ot">TRUE</span>, <span class="dt">wrap=</span><span class="ot">TRUE</span>, <span class="dt">terms_per_line =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## $$
## \begin{aligned}
## \text{Wardcount} &amp;= -10.89 + 0.06(\text{Boroughcount})\ + \\
## &amp;\quad \epsilon
## \end{aligned}
## $$</code></pre>
<p>This would produce the following in RMarkdownâ€¦.</p>
<p><span class="math display">\[
\begin{aligned}
\text{Wardcount} &amp;= -3.82 + 0.05(\text{Boroughcount})\ + \\
&amp;\quad \epsilon
\end{aligned}
\]</span></p>
<p>Have a <a href="https://github.com/datalorax/equatiomatic">look here</a> for more information on using <code>equatiomatic()</code>.</p>
</div>
<div id="validation" class="section level3">
<h3><span class="header-section-number">10.6.7</span> Validation</h3>
<ol style="list-style-type: decimal">
<li>Weâ€™ve made a regression model using all of our data but there is now no way to test its validityâ€¦what if we take 20% as a test sample and use the remaining 80% to train itâ€¦</li>
</ol>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb643-1" title="1">joinedID &lt;-<span class="st"> </span>joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb643-2" title="2"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb643-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Wardcount =</span> <span class="kw">replace_na</span>(Wardcount, <span class="dv">0</span>))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb643-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb643-5" title="5"><span class="co"># Create training 80% index</span></a>
<a class="sourceLine" id="cb643-6" title="6">train &lt;-<span class="st"> </span>joinedID <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb643-7" title="7"><span class="st">  </span><span class="kw">sample_frac</span>(.<span class="dv">70</span>)</a>
<a class="sourceLine" id="cb643-8" title="8"><span class="co"># Create test set</span></a>
<a class="sourceLine" id="cb643-9" title="9">test  &lt;-<span class="st"> </span><span class="kw">anti_join</span>(joinedID, </a>
<a class="sourceLine" id="cb643-10" title="10">                   train, </a>
<a class="sourceLine" id="cb643-11" title="11">                   <span class="dt">by =</span> <span class="st">&#39;id&#39;</span>)</a></code></pre></div>
<p>Now letâ€™s build the modelâ€¦</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb644-1" title="1"><span class="co"># build the model</span></a>
<a class="sourceLine" id="cb644-2" title="2">lmMod &lt;-<span class="st"> </span><span class="kw">lm</span>(Wardcount <span class="op">~</span><span class="st"> </span>Boroughcount, </a>
<a class="sourceLine" id="cb644-3" title="3">            <span class="dt">data=</span>train)  </a>
<a class="sourceLine" id="cb644-4" title="4"><span class="co"># use the model to make some predicitons with our test data</span></a>
<a class="sourceLine" id="cb644-5" title="5"></a>
<a class="sourceLine" id="cb644-6" title="6"><span class="kw">library</span>(caret)</a>
<a class="sourceLine" id="cb644-7" title="7">predictions &lt;-<span class="st"> </span>lmMod <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb644-8" title="8"><span class="st">  </span><span class="kw">predict</span>(test)</a>
<a class="sourceLine" id="cb644-9" title="9"></a>
<a class="sourceLine" id="cb644-10" title="10"><span class="co"># get R2, RMSE and MAE</span></a>
<a class="sourceLine" id="cb644-11" title="11"></a>
<a class="sourceLine" id="cb644-12" title="12">stats&lt;-<span class="kw">data.frame</span>(<span class="dt">R2 =</span> <span class="kw">R2</span>(predictions, test<span class="op">$</span>Wardcount),</a>
<a class="sourceLine" id="cb644-13" title="13">            <span class="dt">RMSE =</span> <span class="kw">RMSE</span>(predictions, test<span class="op">$</span>Wardcount),</a>
<a class="sourceLine" id="cb644-14" title="14">            <span class="dt">MAE =</span> <span class="kw">MAE</span>(predictions, test<span class="op">$</span>Wardcount))</a>
<a class="sourceLine" id="cb644-15" title="15"></a>
<a class="sourceLine" id="cb644-16" title="16">t</a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-506-1.png" width="672" /></p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb645-1" title="1"><span class="co">#for some reason this will show in RStudio</span></a>
<a class="sourceLine" id="cb645-2" title="2"><span class="co">#but not the bookdown (this practical) output.</span></a></code></pre></div>
<ol style="list-style-type: decimal">
<li>We can use the R2, Root Mean Square Error and Mean Absolute Error.</li>
</ol>
<ul>
<li><p><span class="math inline">\(R^2\)</span> is the variation of y explained by x</p></li>
<li><p>Mean Absolute Error measures the average magnitude of the errors (distance of points from the regression line) using:</p></li>
</ul>
<p><span class="math display">\[MAE = {\frac{1}{n}\Sigma_{i=1}^{n}{\Big({d_i -f_i\Big)}}}\]</span></p>
<ul>
<li>Root Mean Square Error (RMSE) is the standard deviation of the resuiduals, this means how far away the points are from the regression lineâ€¦</li>
</ul>
<p><span class="math display">\[RMSE= \sqrt{\frac{1}{n}\Sigma_{i=1}^{n}{\Big({d_i -f_i}\Big)^2}}\]</span>
Where <span class="math inline">\(d_i\)</span> is the actual value, <span class="math inline">\(d_f\)</span> is the predicted value, and <span class="math inline">\(n\)</span> is the number of data points</p>
<p>We could also just run a correlation between the data we left out and the predicted data to assess the accuracyâ€¦</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb646-1" title="1">actuals_preds &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">actuals=</span>test<span class="op">$</span>Wardcount,</a>
<a class="sourceLine" id="cb646-2" title="2">                                  <span class="dt">predicteds=</span>predictions))</a>
<a class="sourceLine" id="cb646-3" title="3"></a>
<a class="sourceLine" id="cb646-4" title="4"></a>
<a class="sourceLine" id="cb646-5" title="5">actuals_preds_correlation &lt;-<span class="st"> </span>actuals_preds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb646-6" title="6"><span class="st">    </span><span class="kw">correlate</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb646-7" title="7"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   rowname    actuals predicteds
##   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
## 1 actuals     NA          0.776
## 2 predicteds   0.776     NA</code></pre>
<p>This shows us that we have a strong and significant relationship between our model output and the test data.</p>
<ol style="list-style-type: decimal">
<li>We can also use min-max accuracy to see how close the actual and predicted values areâ€¦using the equationâ€¦</li>
</ol>
<p><span class="math display">\[MinMaxAccuracy= mean\left( \frac{min(actuals, predicteds}{max(actuals, predicteds)} \right)\]</span></p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb648-1" title="1">min_max_accuracy &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">apply</span>(actuals_preds, <span class="dv">1</span>, min, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">/</span></a>
<a class="sourceLine" id="cb648-2" title="2"><span class="st">                          </span><span class="kw">apply</span>(actuals_preds, <span class="dv">1</span>, max, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))  </a>
<a class="sourceLine" id="cb648-3" title="3">min_max_accuracy</a></code></pre></div>
<pre><code>## [1] 0.5168844</code></pre>
<ol start="22" style="list-style-type: decimal">
<li>This gives around a 60% accuracyâ€¦another alternative is mean absolute percentage deviation which is a statistical measure showing how accurate the prediciton wasâ€¦through the equationâ€¦</li>
</ol>
<p><span class="math display">\[MAPE= mean\left( \frac{abs(predicteds - actuals}{actuals} \right)\]</span></p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb650-1" title="1">mape &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">abs</span>((actuals_preds<span class="op">$</span>predicteds <span class="op">-</span></a>
<a class="sourceLine" id="cb650-2" title="2"><span class="st">                    </span>actuals_preds<span class="op">$</span>actuals))<span class="op">/</span></a>
<a class="sourceLine" id="cb650-3" title="3"><span class="st">               </span>actuals_preds<span class="op">$</span>actuals, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)  </a>
<a class="sourceLine" id="cb650-4" title="4"></a>
<a class="sourceLine" id="cb650-5" title="5">mape</a></code></pre></div>
<pre><code>## [1] Inf</code></pre>
<p>Here weâ€™ve got a very high MAPE â€” this is most likely because of the range of values of the wards for individual boroughsâ€¦</p>
</div>
<div id="cross-validation" class="section level3">
<h3><span class="header-section-number">10.6.8</span> Cross validation</h3>
<ol style="list-style-type: decimal">
<li>Our validation approach so far was OK, but what if the test data was a different 20% â€” would it still hold up? We can test this by dividing all our data into blocks and then running the analysis several times, each time selecting a different block to be the test dataâ€¦this is called cross validation â€¦</li>
</ol>
<p><img src="prac10_images/cross_validation.jpg" width="600" style="display: block; margin: auto;" /></p>
<ol start="24" style="list-style-type: decimal">
<li>To start with weâ€™ll remove the geomtery, set up a data frame and replace any NAs with 0 â€” this is appropraite here as if there are no Airbnbs within the ward they would be 0.</li>
</ol>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb652-1" title="1">joined_CV &lt;-<span class="st"> </span>joined <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb652-2" title="2"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb652-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Wardcount =</span> <span class="kw">replace_na</span>(Wardcount, <span class="dv">0</span>))</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Now letâ€™s change our training dataâ€¦ here iâ€™ve got 5 iterations then the whole lot is repeated 3 times. Search literautre for the right number to use, i think 10 iterations with no repeats is a good place to start.</li>
</ol>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb653-1" title="1"><span class="kw">library</span>(caret)</a>
<a class="sourceLine" id="cb653-2" title="2">model&lt;-<span class="st"> </span><span class="kw">train</span>(Wardcount <span class="op">~</span><span class="st"> </span>Boroughcount, </a>
<a class="sourceLine" id="cb653-3" title="3">              joined_CV,</a>
<a class="sourceLine" id="cb653-4" title="4">              <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, </a>
<a class="sourceLine" id="cb653-5" title="5">              <span class="dt">trControl=</span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;repeatedcv&quot;</span>,</a>
<a class="sourceLine" id="cb653-6" title="6">                                     <span class="dt">number=</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb653-7" title="7">                                     <span class="dt">repeats=</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb653-8" title="8">                                     <span class="co"># change to true to</span></a>
<a class="sourceLine" id="cb653-9" title="9">                                     <span class="co"># see it iterate</span></a>
<a class="sourceLine" id="cb653-10" title="10">                                     <span class="dt">verboseIter=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb653-11" title="11"></a>
<a class="sourceLine" id="cb653-12" title="12"><span class="kw">summary</span>(model)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -347.88  -38.61    0.26   20.97  708.12 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -10.935710   6.184881  -1.768   0.0776 .  
## Boroughcount   0.055028   0.001816  30.294   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 100.7 on 554 degrees of freedom
## Multiple R-squared:  0.6236, Adjusted R-squared:  0.6229 
## F-statistic: 917.7 on 1 and 554 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" title="1"><span class="co">#print R2, MAE and RMSE</span></a>
<a class="sourceLine" id="cb655-2" title="2"><span class="kw">print</span>(model)</a></code></pre></div>
<pre><code>## Linear Regression 
## 
## 556 samples
##   1 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold, repeated 3 times) 
## Summary of sample sizes: 444, 447, 445, 444, 444, 444, ... 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   99.65453  0.6364164  57.45796
## 
## Tuning parameter &#39;intercept&#39; was held constant at a value of TRUE</code></pre>
<p>Results show that our cross validated model accounts for around 60% of varaince of the number of Airbnbs per wardâ€¦compare this to the results from the standard linear regressionâ€¦</p>
</div>
</div>
<div id="advanced-regression" class="section level2">
<h2><span class="header-section-number">10.7</span> Advanced regression</h2>
<div id="more-data" class="section level3">
<h3><span class="header-section-number">10.7.1</span> More data</h3>
<ol style="list-style-type: decimal">
<li>Weâ€™re going to have a look at Ridge and LASSO regression nextâ€¦however, they require us to have more than 1 predictor variable, so weâ€™ll load a few in and demonstrate how to use them in normal regression firstâ€¦</li>
</ol>
<p>Weâ€™ll get our OSM data, project it, extract only hotels, join it with the boroughs, set any NAs to 0, join it with the wards, rename the new â€˜freqâ€™ coloumn to Hotel count, remove the geometry and then set any more NAs to 0â€¦</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb657-1" title="1"><span class="co"># read in OSM data</span></a>
<a class="sourceLine" id="cb657-2" title="2">OSM &lt;-<span class="st"> </span><span class="kw">st_read</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;prac10_data&quot;</span>, <span class="st">&quot;geofabrik&quot;</span>, <span class="st">&quot;gis_osm_pois_a_free_1.shp&quot;</span>))</a></code></pre></div>
<pre><code>## Reading layer `gis_osm_pois_a_free_1&#39; from data source `C:\Users\Andy\OneDrive - University College London\Teaching\CASA0005\2020_2021\CASA0005repo\prac10_data\geofabrik\gis_osm_pois_a_free_1.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 37108 features and 4 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -0.5108706 ymin: 51.28117 xmax: 0.322123 ymax: 51.68948
## geographic CRS: WGS 84</code></pre>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb659-1" title="1"><span class="co"># project and filter</span></a>
<a class="sourceLine" id="cb659-2" title="2">OSM &lt;-<span class="st"> </span>OSM <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-3" title="3"><span class="st">  </span><span class="kw">st_transform</span>(., <span class="dv">27700</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-4" title="4"><span class="st">  </span><span class="kw">filter</span>(fclass <span class="op">==</span><span class="st"> &quot;hotel&quot;</span>)</a>
<a class="sourceLine" id="cb659-5" title="5"></a>
<a class="sourceLine" id="cb659-6" title="6"><span class="co"># join hotels with the boroughs</span></a>
<a class="sourceLine" id="cb659-7" title="7"></a>
<a class="sourceLine" id="cb659-8" title="8">Hotels_borough &lt;-<span class="st"> </span>OSM <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-9" title="9"><span class="st">  </span><span class="kw">Joinfun</span>(., boroughsandwardssf[[<span class="dv">1</span>]]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-10" title="10"><span class="st">  </span><span class="co"># rename hotels</span></a>
<a class="sourceLine" id="cb659-11" title="11"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">hotels =</span> airbnbs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-12" title="12"><span class="st">  </span><span class="co"># replae NA with 0</span></a>
<a class="sourceLine" id="cb659-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hotels =</span> <span class="kw">replace_na</span>(hotels, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb659-14" title="14"></a>
<a class="sourceLine" id="cb659-15" title="15"></a>
<a class="sourceLine" id="cb659-16" title="16">joined2&lt;-joined <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-17" title="17"><span class="st">  </span><span class="kw">st_drop_geometry</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-18" title="18"><span class="st">  </span><span class="kw">left_join</span>(., </a>
<a class="sourceLine" id="cb659-19" title="19">            Hotels_borough,</a>
<a class="sourceLine" id="cb659-20" title="20">            <span class="dt">by=</span> <span class="kw">c</span>(<span class="st">&quot;GSS_CODE.x&quot;</span> =<span class="st"> &quot;GSS_CODE&quot;</span>))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-21" title="21"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(NAME.y,GSS_CODE.x, Boroughcount, Wardcount, hotels)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-22" title="22"><span class="st">  </span><span class="kw">distinct</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb659-23" title="23"><span class="st">  </span><span class="co">#replace NA in wards with 0</span></a>
<a class="sourceLine" id="cb659-24" title="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Wardcount =</span> <span class="kw">replace_na</span>(Wardcount, <span class="dv">0</span>))</a></code></pre></div>
</div>
<div id="multiple-linear-regression" class="section level3">
<h3><span class="header-section-number">10.7.2</span> Multiple linear regression</h3>
<ol style="list-style-type: decimal">
<li>Re run the model including Hotel countâ€¦you simply use a +</li>
</ol>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb660-1" title="1">model2&lt;-<span class="st"> </span><span class="kw">train</span>(Wardcount <span class="op">~</span><span class="st"> </span>Boroughcount<span class="op">+</span>hotels, </a>
<a class="sourceLine" id="cb660-2" title="2">              joined2,</a>
<a class="sourceLine" id="cb660-3" title="3">              <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, </a>
<a class="sourceLine" id="cb660-4" title="4">              <span class="dt">trControl=</span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;repeatedcv&quot;</span>,</a>
<a class="sourceLine" id="cb660-5" title="5">                                     <span class="dt">number=</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb660-6" title="6">                                     <span class="dt">repeats=</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb660-7" title="7">                                     <span class="co"># change to true to see it </span></a>
<a class="sourceLine" id="cb660-8" title="8">                                     <span class="co"># iterate</span></a>
<a class="sourceLine" id="cb660-9" title="9">                                     <span class="dt">verboseIter=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb660-10" title="10"></a>
<a class="sourceLine" id="cb660-11" title="11"><span class="kw">summary</span>(model2)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -340.04  -38.24    0.51   21.02  715.96 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -11.485809   6.342871  -1.811   0.0707 .  
## Boroughcount   0.055620   0.002351  23.656   &lt;2e-16 ***
## hotels        -0.033929   0.085485  -0.397   0.6916    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 100.8 on 553 degrees of freedom
## Multiple R-squared:  0.6237, Adjusted R-squared:  0.6223 
## F-statistic: 458.2 on 2 and 553 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The summary here shows that the hotel count predictor is not statistically significant so we should remove itâ€¦how about we add some population and house price dataâ€¦.download <a href="https://data.london.gov.uk/dataset/ward-profiles-and-atlas">the excel data from here</a></p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" title="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb662-2" title="2"><span class="kw">library</span>(janitor)</a>
<a class="sourceLine" id="cb662-3" title="3"><span class="co"># read the excel sheet</span></a>
<a class="sourceLine" id="cb662-4" title="4">my_data &lt;-<span class="st"> </span><span class="kw">read_excel</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;prac10_data&quot;</span>,<span class="st">&quot;ward-profiles-excel-version.xls&quot;</span>),</a>
<a class="sourceLine" id="cb662-5" title="5">                                 <span class="dt">sheet=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb662-6" title="6">                                 <span class="dt">col_names=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb662-7" title="7"><span class="st">  </span><span class="co"># set it as a data frame</span></a>
<a class="sourceLine" id="cb662-8" title="8"><span class="st">  </span><span class="kw">as.data.frame</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb662-9" title="9"><span class="st">  </span><span class="kw">clean_names</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb662-10" title="10"><span class="st">  </span><span class="co"># extract everything that begins with E</span></a>
<a class="sourceLine" id="cb662-11" title="11"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(new_code, <span class="st">&quot;^E&quot;</span>))</a>
<a class="sourceLine" id="cb662-12" title="12"></a>
<a class="sourceLine" id="cb662-13" title="13"><span class="co"># is our data num</span></a>
<a class="sourceLine" id="cb662-14" title="14">Datatypelist &lt;-<span class="st"> </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb662-15" title="15"><span class="st">  </span><span class="kw">summarise_all</span>(class) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb662-16" title="16"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(), </a>
<a class="sourceLine" id="cb662-17" title="17">               <span class="dt">names_to=</span><span class="st">&quot;All_variables&quot;</span>, </a>
<a class="sourceLine" id="cb662-18" title="18">               <span class="dt">values_to=</span><span class="st">&quot;Variable_class&quot;</span>)</a>
<a class="sourceLine" id="cb662-19" title="19"></a>
<a class="sourceLine" id="cb662-20" title="20"><span class="co"># make sure the variables are numeric</span></a>
<a class="sourceLine" id="cb662-21" title="21">my_data &lt;-<span class="st"> </span>my_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb662-22" title="22"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="dt">.cols =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">67</span>, as.numeric))</a>
<a class="sourceLine" id="cb662-23" title="23"></a>
<a class="sourceLine" id="cb662-24" title="24"><span class="co"># merge the new data to the existing data</span></a>
<a class="sourceLine" id="cb662-25" title="25">joined3 &lt;-joined2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb662-26" title="26"><span class="st">  </span><span class="kw">left_join</span>(.,</a>
<a class="sourceLine" id="cb662-27" title="27">            my_data,</a>
<a class="sourceLine" id="cb662-28" title="28">            <span class="dt">by=</span> <span class="kw">c</span>(<span class="st">&quot;GSS_CODE.x&quot;</span> =<span class="st"> &quot;new_code&quot;</span>))</a></code></pre></div>
<ol start="28" style="list-style-type: decimal">
<li>Now run the model again</li>
</ol>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" title="1">model3&lt;-<span class="st"> </span><span class="kw">train</span>(Wardcount <span class="op">~</span><span class="st"> </span>Boroughcount<span class="op">+</span>population_<span class="dv">2015</span></a>
<a class="sourceLine" id="cb663-2" title="2">               <span class="op">+</span>median_house_price_<span class="dv">2014</span>,</a>
<a class="sourceLine" id="cb663-3" title="3">              joined3,</a>
<a class="sourceLine" id="cb663-4" title="4">              <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, </a>
<a class="sourceLine" id="cb663-5" title="5">              <span class="dt">trControl=</span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;repeatedcv&quot;</span>,</a>
<a class="sourceLine" id="cb663-6" title="6">                                     <span class="dt">number=</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb663-7" title="7">                                     <span class="dt">repeats=</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb663-8" title="8">                                     <span class="dt">verboseIter=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb663-9" title="9"></a>
<a class="sourceLine" id="cb663-10" title="10"><span class="kw">summary</span>(model3)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -351.59  -34.88   -3.98   21.15  704.41 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)              3.664e+01  2.878e+01   1.273   0.2035    
## Boroughcount             5.432e-02  2.623e-03  20.709   &lt;2e-16 ***
## population_2015         -1.700e-04  7.873e-05  -2.159   0.0313 *  
## median_house_price_2014  2.218e-06  3.544e-05   0.063   0.9501    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 100.2 on 553 degrees of freedom
## Multiple R-squared:  0.6281, Adjusted R-squared:  0.626 
## F-statistic: 311.3 on 3 and 553 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Our R squared and adjusted R squared have increased (albeit slightly) and all predictors are statistically significant.</p>
<blockquote>
<p><strong>Note</strong> that whilst i have selected variables pretty randomly here for demonstration, if you use something like this in practice itâ€™s important to have supported (referenced) reasoning behind your selections.</p>
</blockquote>
</div>
<div id="ridge-regression" class="section level3">
<h3><span class="header-section-number">10.7.3</span> Ridge regression</h3>
<p><img src="prac10_images/ridge.jpg" width="300" style="display: block; margin: auto;" /></p>
<p>Least squares regression tries to minimise how far each point is away from the lineâ€¦but if you look in this figureâ€¦the red dots are the training data and the green dots are the test data. Here normal OLS has been fitted to the training data perfcetlyâ€¦the sum of the sqaured residuals (squared error distance from the line) is very small, probably 0. But when applied to the test data the sum of the squared residuals is large â€” it therefore has high variance and would be termed to be overfitting the training data.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-518"></span>
<img src="prac10_images/ridge_eg.png" alt="This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest" width="300" />
<p class="caption">
Figure 10.1: This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest
</p>
</div>
<p>Ridge regression probably wonâ€™t fit our training data as well, becuase we introduce a small amount of bias (adding value to the intercept â€” which is the Y value when X=0) to give us less overall variance (the difference between the point and line value)â€¦So essentially when the values are calculated the formula is trying to get the line of best fit through all the points with each point having minimum distance to the line.</p>
<p>Ridge regression also tries to minimise the sum of the sqaured residuals (distance to the line) but then adds <span class="math inline">\(\lambda\)</span> x <span class="math inline">\(slope^2\)</span> â€” this increases the value of Y when X=0.</p>
<p>Ok so letâ€™s try and look at this with numbersâ€¦</p>
<p>The goal here is to minimise the sum of the sqaured residualsâ€¦plus the ridge regression penalty <span class="math inline">\(\lambda * slope^2\)</span>â€¦</p>
<p>Firstly letâ€™s assume you have a perfectly fit line â€” the sum of the least sqaure residuals would be 0 (the line overlaps the points). Assume <span class="math inline">\(\lambda\)</span> is 0.5 and the slope is 1.2, we have 0 + 1.44 = 1.44</p>
<p>Now we use ridge regression that shifts the line away from the perfect fit (with a bias penalty) that we had in least square regressionâ€¦this would create residual values as the points no longer perfectly fit the line, assume these add to 0.2, <span class="math inline">\(\lambda\)</span> is 0.5, and the slope is 0.7â€¦so this would give 0.445.</p>
<p>So if we were trying to minimise the sum of the sqaured residuals plus the ridge regression penatly the ridge regression wins with a lower value.</p>
<p>The penatly <span class="math inline">\(\lambda * slope^2\)</span> adds a bias (value to the intercept) to reduce the slope of the line as it tries to the minimise the sum of the distance of the points from the line and hopefully the variance between the line and the pointsâ€¦like this â€” Ridge is the blue line that has become slightly more horizontalâ€¦</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-519"></span>
<img src="prac10_images/ridge_eg2.png" alt="This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest" width="300" />
<p class="caption">
Figure 10.2: This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest
</p>
</div>
<p>But waitâ€¦. how do we calcualte <span class="math inline">\(\lambda\)</span>, well we try a load of values and use cross validation (10 fold) to get the overall lowest variance from the line to the data points! COOL!!!!</p>
<ol start="29" style="list-style-type: decimal">
<li>Letâ€™s see an exmaple to show that if <span class="math inline">\(\lambda\)</span> is 0, then we have our box standard linear regressionâ€¦as the penalty <span class="math inline">\(\lambda * the slope^2\)</span> will be 0, so we will just be minimising the sum of the sqaured residuals.</li>
</ol>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb665-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb665-2" title="2"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb665-3" title="3"><span class="kw">library</span>(glmnet)</a>
<a class="sourceLine" id="cb665-4" title="4"></a>
<a class="sourceLine" id="cb665-5" title="5"></a>
<a class="sourceLine" id="cb665-6" title="6"><span class="co"># sort the data our for ridge regression</span></a>
<a class="sourceLine" id="cb665-7" title="7">y &lt;-<span class="st"> </span>joined3<span class="op">$</span>Wardcount <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb665-8" title="8"><span class="st">  </span><span class="co"># set NAs to 0</span></a>
<a class="sourceLine" id="cb665-9" title="9"><span class="st">  </span><span class="kw">replace_na</span>(., <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb665-10" title="10"></a>
<a class="sourceLine" id="cb665-11" title="11">x &lt;-<span class="st"> </span>joined3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb665-12" title="12"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Boroughcount, hotels,</a>
<a class="sourceLine" id="cb665-13" title="13">                                 population_<span class="dv">2015</span>,</a>
<a class="sourceLine" id="cb665-14" title="14">                                 median_house_price_<span class="dv">2014</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb665-15" title="15"><span class="st">  </span><span class="kw">data.matrix</span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb665-16" title="16"><span class="st">  </span><span class="co"># set NAs to 0</span></a>
<a class="sourceLine" id="cb665-17" title="17"><span class="st">  </span><span class="kw">replace_na</span>(., <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb665-18" title="18"></a>
<a class="sourceLine" id="cb665-19" title="19"></a>
<a class="sourceLine" id="cb665-20" title="20"><span class="co"># set seed means that if we re run this </span></a>
<a class="sourceLine" id="cb665-21" title="21"><span class="co"># we will get the same results</span></a>
<a class="sourceLine" id="cb665-22" title="22"><span class="kw">set.seed</span>(<span class="dv">489</span>)</a>
<a class="sourceLine" id="cb665-23" title="23"><span class="co"># this gives us a 50/50 split between</span></a>
<a class="sourceLine" id="cb665-24" title="24"><span class="co"># training and test data</span></a>
<a class="sourceLine" id="cb665-25" title="25">train =<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(x), <span class="kw">nrow</span>(x)<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb665-26" title="26">test =<span class="st"> </span>(<span class="op">-</span>train)</a>
<a class="sourceLine" id="cb665-27" title="27">ytest =<span class="st"> </span>y[test]</a>
<a class="sourceLine" id="cb665-28" title="28">xtest =x[test]</a>
<a class="sourceLine" id="cb665-29" title="29"></a>
<a class="sourceLine" id="cb665-30" title="30"><span class="co"># run normmal regression</span></a>
<a class="sourceLine" id="cb665-31" title="31">normallm &lt;-<span class="st"> </span><span class="kw">lm</span>(Wardcount <span class="op">~</span><span class="st"> </span>hotels<span class="op">+</span>Boroughcount<span class="op">+</span>population_<span class="dv">2015</span></a>
<a class="sourceLine" id="cb665-32" title="32">               <span class="op">+</span>median_house_price_<span class="dv">2014</span>,</a>
<a class="sourceLine" id="cb665-33" title="33">               <span class="dt">data =</span> joined3)</a>
<a class="sourceLine" id="cb665-34" title="34"><span class="kw">summary</span>(normallm)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Wardcount ~ hotels + Boroughcount + population_2015 + 
##     median_house_price_2014, data = joined3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -334.19  -35.85   -2.95   20.95  721.81 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)              3.175e+01  2.935e+01   1.082   0.2798    
## hotels                  -7.851e-02  9.174e-02  -0.856   0.3925    
## Boroughcount             5.506e-02  2.761e-03  19.944   &lt;2e-16 ***
## population_2015         -1.679e-04  7.878e-05  -2.132   0.0335 *  
## median_house_price_2014  1.350e-05  3.782e-05   0.357   0.7213    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 100.3 on 552 degrees of freedom
## Multiple R-squared:  0.6286, Adjusted R-squared:  0.6259 
## F-statistic: 233.5 on 4 and 552 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" title="1"><span class="co"># make a variable for loads of lambda values</span></a>
<a class="sourceLine" id="cb667-2" title="2"><span class="co"># just for the example here</span></a>
<a class="sourceLine" id="cb667-3" title="3">lambda &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">-2</span>, <span class="dt">length =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb667-4" title="4"></a>
<a class="sourceLine" id="cb667-5" title="5"><span class="co">#run ridge regression, here we use x to predict y</span></a>
<a class="sourceLine" id="cb667-6" title="6">ridge_mod &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">alpha =</span> <span class="dv">0</span>, <span class="dt">lambda =</span> lambda)</a>
<a class="sourceLine" id="cb667-7" title="7"><span class="co"># x and y are our original data,</span></a>
<a class="sourceLine" id="cb667-8" title="8"><span class="co">#s is the size of the penalty which is 0</span></a>
<a class="sourceLine" id="cb667-9" title="9"><span class="co"># and we want the coefficients out</span></a>
<a class="sourceLine" id="cb667-10" title="10"><span class="kw">predict</span>(ridge_mod, <span class="dt">x=</span>x,<span class="dt">y=</span>y, <span class="dt">s =</span> <span class="dv">0</span>, <span class="dt">exact =</span> T, <span class="dt">type =</span> <span class="st">&#39;coefficients&#39;</span>)</a></code></pre></div>
<pre><code>## 5 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                                     1
## (Intercept)              3.172445e+01
## Boroughcount             5.505627e-02
## hotels                  -7.854144e-02
## population_2015         -1.678941e-04
## median_house_price_2014  1.353453e-05</code></pre>
<ol style="list-style-type: decimal">
<li>The coefficient estaimtes should be the same or very very similarâ€¦now letâ€™s try and use ridge regression to improve upon our least squares regressionâ€¦first letâ€™s show linear regression for comparison using the train data..</li>
</ol>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb669-1" title="1">normallm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(Wardcount <span class="op">~</span><span class="st"> </span>hotels<span class="op">+</span>Boroughcount<span class="op">+</span>population_<span class="dv">2015</span></a>
<a class="sourceLine" id="cb669-2" title="2">               <span class="op">+</span>median_house_price_<span class="dv">2014</span>, </a>
<a class="sourceLine" id="cb669-3" title="3">               <span class="dt">data =</span> joined3, </a>
<a class="sourceLine" id="cb669-4" title="4">               <span class="dt">subset =</span> train)</a>
<a class="sourceLine" id="cb669-5" title="5"></a>
<a class="sourceLine" id="cb669-6" title="6"></a>
<a class="sourceLine" id="cb669-7" title="7">s_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(normallm2, <span class="dt">newdata =</span> joined3[test,])</a>
<a class="sourceLine" id="cb669-8" title="8"><span class="kw">mean</span>((s_pred<span class="op">-</span>ytest)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 8068.011</code></pre>
<ol style="list-style-type: decimal">
<li>Now we will find the best value for <span class="math inline">\(\lambda\)</span> using cross validation</li>
</ol>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" title="1"><span class="co">#find the best lambda from our list via cross-validation</span></a>
<a class="sourceLine" id="cb671-2" title="2"><span class="co"># family = gaussian means linear regression</span></a>
<a class="sourceLine" id="cb671-3" title="3"><span class="co"># type.measure = how cross evaluation will be evaluated </span></a>
<a class="sourceLine" id="cb671-4" title="4"><span class="co"># mse is mean square error</span></a>
<a class="sourceLine" id="cb671-5" title="5">cv_out &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(x[train,], </a>
<a class="sourceLine" id="cb671-6" title="6">                    y[train],</a>
<a class="sourceLine" id="cb671-7" title="7">                    <span class="dt">alpha =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb671-8" title="8">                    <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>,</a>
<a class="sourceLine" id="cb671-9" title="9">                    <span class="dt">type.measure =</span> <span class="st">&quot;mse&quot;</span>)</a></code></pre></div>
<p>Combined, this will fit a linear regression with a ridge regression penatly using 10-fold cross validation to find the best <span class="math inline">\(\lambda\)</span> value that minimises mean square error (average squared distance of the data points to the line). Letâ€™s apply it to the modelâ€¦</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" title="1"><span class="kw">plot</span>(cv_out)</a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-523-1.png" width="672" /></p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb673-1" title="1"><span class="co"># best value </span></a>
<a class="sourceLine" id="cb673-2" title="2">opt_lambda &lt;-<span class="st"> </span>cv_out<span class="op">$</span>lambda.min</a>
<a class="sourceLine" id="cb673-3" title="3"></a>
<a class="sourceLine" id="cb673-4" title="4"><span class="co"># prediction to the testing data</span></a>
<a class="sourceLine" id="cb673-5" title="5"><span class="co"># s is set to optimal lambda</span></a>
<a class="sourceLine" id="cb673-6" title="6"><span class="co"># you could also use lambda.1se as</span></a>
<a class="sourceLine" id="cb673-7" title="7"><span class="co"># technically they are indistinguishable </span></a>
<a class="sourceLine" id="cb673-8" title="8">ridge_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(ridge_mod, <span class="dt">s =</span> opt_lambda, <span class="dt">newx =</span> x[test,])</a>
<a class="sourceLine" id="cb673-9" title="9"></a>
<a class="sourceLine" id="cb673-10" title="10"><span class="co"># rsquared</span></a>
<a class="sourceLine" id="cb673-11" title="11">ridge_r &lt;-<span class="st"> </span><span class="kw">cor</span>(y[test], ridge_pred)<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb673-12" title="12">ridge_r</a></code></pre></div>
<pre><code>##              1
## [1,] 0.6543214</code></pre>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" title="1"><span class="co"># mean square error</span></a>
<a class="sourceLine" id="cb675-2" title="2"><span class="kw">mean</span>((ridge_pred<span class="op">-</span>ytest)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 7134.638</code></pre>
<p>You can also doing this in a few less steps with the <code>ridge</code> package</p>
</div>
<div id="lasso" class="section level3">
<h3><span class="header-section-number">10.7.4</span> LASSO</h3>
<p><img src="prac10_images/LASSO.jpg" width="200" style="display: block; margin: auto;" /></p>
<p>Least absolute shrinkage and selection operator (LASSO) performs variable selection and regularisation to increase prediction accuracy of the modelâ€¦the only difference to ridge is that the regularisation term is an absolute value. So instead of squaring the slope (like i metioned in Ridge regression), we take the absolute value. As a result LASSO regression can increase <span class="math inline">\(\lambda\)</span> then set irrelevant parameters to 0 (Ridge will just shrink them but not set to 0) â€” relevant paramters might shink a little bit in both too. The advantage here is that LASSO can exclude useless variables â€” so if you have a lot of variables it might be preferable. However, if most variables are useful then Ridge regression would probably work better.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb677-1" title="1"><span class="co">#find the best lambda from our list via cross-validation</span></a>
<a class="sourceLine" id="cb677-2" title="2">cv_out &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(x[train,], </a>
<a class="sourceLine" id="cb677-3" title="3">                    y[train], </a>
<a class="sourceLine" id="cb677-4" title="4">                    <span class="dt">alpha =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb677-5" title="5">                    <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>, </a>
<a class="sourceLine" id="cb677-6" title="6">                    <span class="dt">type.measure =</span> <span class="st">&quot;mse&quot;</span>)</a>
<a class="sourceLine" id="cb677-7" title="7"></a>
<a class="sourceLine" id="cb677-8" title="8"><span class="kw">plot</span>(cv_out)</a></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-525-1.png" width="672" /></p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb678-1" title="1"><span class="co"># best value </span></a>
<a class="sourceLine" id="cb678-2" title="2">opt_lambda &lt;-<span class="st"> </span>cv_out<span class="op">$</span>lambda.min</a>
<a class="sourceLine" id="cb678-3" title="3"></a>
<a class="sourceLine" id="cb678-4" title="4"><span class="co"># make the model</span></a>
<a class="sourceLine" id="cb678-5" title="5">lasso_mod &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x[train,], y[train], <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">lambda =</span> opt_lambda)</a>
<a class="sourceLine" id="cb678-6" title="6"></a>
<a class="sourceLine" id="cb678-7" title="7"><span class="co"># make the prediction </span></a>
<a class="sourceLine" id="cb678-8" title="8">lasso_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(lasso_mod, <span class="dt">s =</span> opt_lambda, <span class="dt">newx =</span> x[test,])</a>
<a class="sourceLine" id="cb678-9" title="9"></a>
<a class="sourceLine" id="cb678-10" title="10"><span class="co"># r sqaured</span></a>
<a class="sourceLine" id="cb678-11" title="11">LASSO_r &lt;-<span class="st"> </span><span class="kw">cor</span>(y[test], lasso_pred)<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb678-12" title="12">LASSO_r</a></code></pre></div>
<pre><code>##              1
## [1,] 0.6423348</code></pre>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb680-1" title="1"><span class="co"># mean square error</span></a>
<a class="sourceLine" id="cb680-2" title="2"><span class="kw">mean</span>((lasso_pred<span class="op">-</span>ytest)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 7588.756</code></pre>
</div>
<div id="elastic-net-regression" class="section level3">
<h3><span class="header-section-number">10.7.5</span> Elastic net regression</h3>
<p>When you donâ€™t know much about our variables in a model you can use Elastic-Net Regression. It starts with least squares then adds the LASSO and ridge regression penatly, allowing you to use the strengths of both. Both the LASSO penatly and ridge penatly get their own <span class="math inline">\(\lambda\)</span> values, <span class="math inline">\(\lambda_1\)</span> for LASSO, <span class="math inline">\(\lambda_2\)</span> for ridge. Cross validation runs for both <span class="math inline">\(\lambda_1\)</span> and <span class="math inline">\(\lambda_2\)</span>. If both <span class="math inline">\(\lambda_1\)</span> and <span class="math inline">\(\lambda_2\)</span> &gt; 0 then we get a hybrid approach, this is good when we have correlated variables. LASSO will pick just one correlated variable and eliminate the other, whereas ridge will just shrink all of them. Using both LASSO and ridge we can group and shrink correlated variables or remove them all at the same time.</p>
<p>In R, Elastic-Net Regression is where you change the alpha value between 0 and 1. You would use elastic net regression to see if it is possible to reduce the mean square error any further. Have a look at <a href="https://www.youtube.com/watch?v=ctmNq7FgbvI">this video</a> to see how to use a for loop to test different values for alpha.</p>
</div>
<div id="whats-the-best-here" class="section level3">
<h3><span class="header-section-number">10.7.6</span> Whatâ€™s the best here</h3>
<p>Letâ€™s compare the results of the MSE and r sqaured for the normallm2, LASSO and Ridge as we used the same predictorsâ€¦this is the code to get the values we donâ€™t already haveâ€¦</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" title="1"><span class="kw">summary</span>(normallm2)<span class="op">$</span>r.squared</a></code></pre></div>
<pre><code>## [1] 0.6274311</code></pre>
<p>Our lowest MSE and highest R sqaured value here is provided by Ridge regressionâ€¦so from this anaylsis iâ€™d select Ridge regression to predict any missing or future values of Airbnbs within the London wardsâ€¦iâ€™d probably also conisder exploring using machine learning methods that are linked to belowâ€¦</p>
<blockquote>
<p><strong>Warning</strong> The data used within this practical is purely for demonstration purposes!</p>
</blockquote>
</div>
<div id="what-should-i-use" class="section level3">
<h3><span class="header-section-number">10.7.7</span> What should i use</h3>
<p>It depends, just because Ridge regression seems to be the best for this application, it might not be for yours. Itâ€™s important to check the suitability of each method for both your data and analysis.</p>
</div>
<div id="so-how-do-i-predict" class="section level3">
<h3><span class="header-section-number">10.7.8</span> So how do i predict</h3>
<p>Easyâ€¦just go back through the code and use the the <code>predict()</code> function â€” this will also work for linear modelsâ€¦</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb684-1" title="1"><span class="co"># replace with your data - this is just an example</span></a>
<a class="sourceLine" id="cb684-2" title="2"><span class="co"># setting intervals specifies confidence intervals</span></a>
<a class="sourceLine" id="cb684-3" title="3"><span class="co"># at the required level</span></a>
<a class="sourceLine" id="cb684-4" title="4"><span class="kw">predict</span>(linearmodel, newdata, <span class="dt">interval=</span><span class="st">&quot;confidence&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>) </a></code></pre></div>
<blockquote>
<p><strong>WARNING</strong> Never try and predict data outside the range of your values, for example in the first regression model we ran when the count within Boroughs was 0 we had -3.8188 for Airbnbs within wards and itâ€™s impossible to have negative Airbnbs.</p>
</blockquote>
</div>
<div id="should-i-write-advanced-code" class="section level3">
<h3><span class="header-section-number">10.7.9</span> Should i write advanced code</h3>
<p>It would be great if you could write your analysis in as least possible lines of code as possibleâ€¦<strong>BUT</strong> you are not marked on how concise or efficient your code is in this course. My advice would be to get something that works and addresses all of the marking criteria and listen to Hadley Wickhamâ€¦.</p>
<blockquote class="twitter-tweet tw-align-center">
<p lang="en" dir="ltr">
The only way to write good code is to write tons of shitty code first. Feeling shame about bad code stops you from getting to good code
</p>
â€” Hadley Wickham (<span class="citation">(<span class="citeproc-not-found" data-reference-id="hadleywickham"><strong>???</strong></span>)</span>) <a href="https://twitter.com/hadleywickham/status/589068687669243905?ref_src=twsrc%5Etfw">April 17, 2015</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><br/></p>
</div>
</div>
<div id="more-resources" class="section level2">
<h2><span class="header-section-number">10.8</span> More resources</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=Q81RR3yKn30&amp;t=443s">Ridge regression</a></li>
<li><a href="https://www.youtube.com/watch?v=NGf0voTMlcs&amp;t=351s">LASSO regression</a></li>
<li><a href="https://www.youtube.com/watch?v=1dKRdX9bfIo">Elastic net regression</a></li>
<li><a href="https://www.youtube.com/watch?v=ctmNq7FgbvI">All of them in R</a></li>
<li><a href="https://towardsdatascience.com/how-to-select-the-right-evaluation-metric-for-machine-learning-models-part-1-regrression-metrics-3606e25beae0">Evaluation methods</a></li>
<li><a href="https://ucl-new-primo.hosted.exlibrisgroup.com/primo-explore/fulldisplay?docid=UCL_LMS_DS21130746790004761&amp;context=L&amp;vid=UCL_VU2&amp;lang=en_US&amp;search_scope=CSCOP_UCL&amp;adaptor=Local%20Search%20Engine&amp;tab=local&amp;query=any,contains,An%20introduction%20to%20statistical%20learning:%20with%20applications%20in%20R%20-%20section%20on%20Ridge%20and%20LASSO%20-%20Gareth%20James,%20Daniela%20Witten,%20Trevor%20Hastie,%20Robert%20Tibshirani%20,%202013,%20%C2%A92013&amp;offset=0">An Introduction to Statistical Learning with Applications in R</a></li>
</ul>
</div>
<div id="extension-2" class="section level2">
<h2><span class="header-section-number">10.9</span> Extension</h2>
<p>If you are already familiar with these regression methods try the following:</p>
<ul>
<li>Apply them to a dataset of your choice to see if you can predict a specific variable</li>
<li>This <a href="https://supervised-ml-course.netlify.com/">free course by Julia Silge</a> on supversied machine learning is pretty great</li>
<li>Explore and apply machine learning techniques for predicting data such as <a href="https://www.guru99.com/r-random-forest-tutorial.html">Random Forest</a>, <a href="https://machinelearningmastery.com/machine-learning-in-r-step-by-step/">Classification and Regression Trees, Support Vector Machine and others</a></li>
<li>Try out <a href="https://www.r-bloggers.com/fitting-a-model-by-maximum-likelihood/">maximum likelihood</a> for estimating model parameters</li>
<li>Have a look at the <a href="https://rviews.rstudio.com/2019/06/19/a-gentle-intro-to-tidymodels/">new tidymodels package</a></li>
<li>Check out <a href="https://www.youtube.com/watch?v=EuBBz3bI-aA">Machine learning fundamentals</a> too.</li>
</ul>
</div>
<div id="acknowledgement-1" class="section level2">
<h2><span class="header-section-number">10.10</span> Acknowledgement</h2>
<p>Iâ€™m certainly not an expert statistician but <a href="https://www.youtube.com/channel/UCtYLUTtgS3k1Fg4y5tAhLbw">StatQuest with Josh Starmer</a> really helped me explain all this.</p>
</div>
<div id="feedback-9" class="section level2">
<h2><span class="header-section-number">10.11</span> Feedback</h2>
<p>Was anything that we explained unclear this week or was something really clearâ€¦let us know using the <a href="https://forms.gle/w2GUDYc7tSavGy7r6">feedback form</a>. Itâ€™s anonymous and weâ€™ll use the responses to clear any issues up in the future / adapt the material.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="gwr-and-spatially-lagged-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="assignment-resources-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/andrewmaclachlan/CASA0005repo/edit/master/10-prac10.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/andrewmaclachlan/CASA0005repo/raw/master/10-prac10.Rmd"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
